adj_gxg <- away_uw %>%
filter(teamName == act_id)
ngames <- nrow(adj_gxg)
if (ngames > 20) { weightmax <- 4 } else { weightmax <- 1 + ((ngames - 1) * .157894737)  }
weightmin <- 1
weightdist <- (weightmax - weightmin) / (ngames - 1)
if (ngames < 2) { weightdist <- 0 }
weightcurve <- matrix(0, nrow = ngames, ncol = 1)
c <- 1
i <- nrow(weightcurve)
for (c in c:i) {
weightcurve[c] <- weightmin + ((c - 1) * weightdist)
}
weight_sums <- sum(weightcurve)
weight_avg <- mean(weightcurve)
FG_wt <- (adj_gxg$FG_adj * weightcurve) / weight_sums
SR2_wt <- (adj_gxg$SR2_adj * weightcurve) / weight_sums
FG3_wt <- (adj_gxg$FG3_adj * weightcurve) / weight_sums
SR3_wt <- (adj_gxg$SR3_adj * weightcurve) / weight_sums
FT_wt <- (adj_gxg$FT_adj * weightcurve) / weight_sums
FTR_wt <- (adj_gxg$FTR_adj * weightcurve) / weight_sums
ORB_wt <- (adj_gxg$ORB_adj * weightcurve) / weight_sums
DRB_wt <- (adj_gxg$DRB_adj * weightcurve) / weight_sums
TRB_wt <- (adj_gxg$TRB_adj * weightcurve) / weight_sums
AST_wt <- (adj_gxg$AST_adj * weightcurve) / weight_sums
TO_wt <- (adj_gxg$TO_adj * weightcurve) / weight_sums
STL_wt <- (adj_gxg$STL_adj * weightcurve) / weight_sums
BLK_wt <- (adj_gxg$BLK_adj * weightcurve) / weight_sums
PF_wt <- (adj_gxg$PF_adj * weightcurve) / weight_sums
eFG_wt <- (adj_gxg$eFG_adj * weightcurve) / weight_sums
TS_wt <- (adj_gxg$TS_adj * weightcurve) / weight_sums
Pace_wt <- (adj_gxg$Pace_adj * weightcurve) / weight_sums
ORtg_wt <- (adj_gxg$ORtg_adj * weightcurve) / weight_sums
DRtg_wt <- (adj_gxg$DRtg_adj * weightcurve) / weight_sums
oFG_wt <- (adj_gxg$oFG_adj * weightcurve) / weight_sums
oSR2_wt <- (adj_gxg$oSR2_adj * weightcurve) / weight_sums
oFG3_wt <- (adj_gxg$oFG3_adj * weightcurve) / weight_sums
oSR3_wt <- (adj_gxg$oSR3_adj * weightcurve) / weight_sums
oFT_wt <- (adj_gxg$oFT_adj * weightcurve) / weight_sums
oFTR_wt <- (adj_gxg$oFTR_adj * weightcurve) / weight_sums
oORB_wt <- (adj_gxg$oORB_adj * weightcurve) / weight_sums
oDRB_wt <- (adj_gxg$oDRB_adj * weightcurve) / weight_sums
oTRB_wt <- (adj_gxg$oTRB_adj * weightcurve) / weight_sums
oAST_wt <- (adj_gxg$oAST_adj * weightcurve) / weight_sums
oTO_wt <- (adj_gxg$oTO_adj * weightcurve) / weight_sums
oSTL_wt <- (adj_gxg$oSTL_adj * weightcurve) / weight_sums
oBLK_wt <- (adj_gxg$oBLK_adj * weightcurve) / weight_sums
oPF_wt <- (adj_gxg$oPF_adj * weightcurve) / weight_sums
oeFG_wt <- (adj_gxg$oeFG_adj * weightcurve) / weight_sums
oTS_wt <- (adj_gxg$oTS_adj * weightcurve) / weight_sums
FG_wt <- sum(FG_wt)
SR2_wt <- sum(SR2_wt)
FG3_wt <- sum(FG3_wt)
SR3_wt <- sum(SR3_wt)
FT_wt <- sum(FT_wt)
FTR_wt <- sum(FTR_wt)
ORB_wt <- sum(ORB_wt)
DRB_wt <- sum(DRB_wt)
TRB_wt <- sum(TRB_wt)
AST_wt <- sum(AST_wt)
TO_wt <- sum(TO_wt)
STL_wt <- sum(STL_wt)
BLK_wt <- sum(BLK_wt)
PF_wt <- sum(PF_wt)
eFG_wt <- sum(eFG_wt)
TS_wt <- sum(TS_wt)
Pace_wt <- sum(Pace_wt)
ORtg_wt <- sum(ORtg_wt)
DRtg_wt <- sum(DRtg_wt)
oFG_wt <- sum(oFG_wt)
oSR2_wt <- sum(oSR2_wt)
oFG3_wt <- sum(oFG3_wt)
oSR3_wt <- sum(oSR3_wt)
oFT_wt <- sum(oFT_wt)
oFTR_wt <- sum(oFTR_wt)
oORB_wt <- sum(oORB_wt)
oDRB_wt <- sum(oDRB_wt)
oTRB_wt <- sum(oTRB_wt)
oAST_wt <- sum(oAST_wt)
oTO_wt <- sum(oTO_wt)
oSTL_wt <- sum(oSTL_wt)
oBLK_wt <- sum(oBLK_wt)
oPF_wt <- sum(oPF_wt)
oeFG_wt <- sum(oeFG_wt)
oTS_wt <- sum(oTS_wt)
wt_df <- data.frame(act_id,FG_wt,SR2_wt,FG3_wt,SR3_wt,FT_wt,
FTR_wt,ORB_wt,DRB_wt,TRB_wt,AST_wt,TO_wt,
STL_wt,BLK_wt,PF_wt,eFG_wt,TS_wt,oFG_wt,oSR2_wt,oFG3_wt,oSR3_wt,
oFT_wt,oFTR_wt,oORB_wt,oDRB_wt,oTRB_wt,oAST_wt,
oTO_wt,oSTL_wt,oBLK_wt,oPF_wt,oeFG_wt,oTS_wt,
ORtg_wt,DRtg_wt,Pace_wt)
wt_holder_away <- bind_rows(wt_holder_away,wt_df)
}
away_final_wt <- wt_holder_away
colnames(away_final_wt) <- c("Team","FG","SR2","FG3","SR3","FT","FTR","ORB","DRB","TRB",
"AST","TO","STL","BLK","PF","eFG","TS",
"oFG","oSR2","oFG3","oSR3","oFT","oFTR","oORB","oDRB","oTRB",
"oAST","oTO","oSTL","oBLK","oPF","oeFG","oTS",
"ORtg","DRtg","Pace")
##### WEIGHTING - HOME ####
wt_holder_home <- data.frame()
a <- 1
g <- nrow(home_final)
for (a in a:g) {
act_id <- as.character(home_final[a,1])
adj_gxg <- home_uw %>%
filter(teamName == act_id)
ngames <- nrow(adj_gxg)
if (ngames > 20) { weightmax <- 4 } else { weightmax <- 1 + ((ngames - 1) * .157894737)  }
weightmin <- 1
weightdist <- (weightmax - weightmin) / (ngames - 1)
if (ngames < 2) { weightdist <- 0 }
weightcurve <- matrix(0, nrow = ngames, ncol = 1)
c <- 1
i <- nrow(weightcurve)
for (c in c:i) {
weightcurve[c] <- weightmin + ((c - 1) * weightdist)
}
weight_sums <- sum(weightcurve)
weight_avg <- mean(weightcurve)
FG_wt <- (adj_gxg$FG_adj * weightcurve) / weight_sums
SR2_wt <- (adj_gxg$SR2_adj * weightcurve) / weight_sums
FG3_wt <- (adj_gxg$FG3_adj * weightcurve) / weight_sums
SR3_wt <- (adj_gxg$SR3_adj * weightcurve) / weight_sums
FT_wt <- (adj_gxg$FT_adj * weightcurve) / weight_sums
FTR_wt <- (adj_gxg$FTR_adj * weightcurve) / weight_sums
ORB_wt <- (adj_gxg$ORB_adj * weightcurve) / weight_sums
DRB_wt <- (adj_gxg$DRB_adj * weightcurve) / weight_sums
TRB_wt <- (adj_gxg$TRB_adj * weightcurve) / weight_sums
AST_wt <- (adj_gxg$AST_adj * weightcurve) / weight_sums
TO_wt <- (adj_gxg$TO_adj * weightcurve) / weight_sums
STL_wt <- (adj_gxg$STL_adj * weightcurve) / weight_sums
BLK_wt <- (adj_gxg$BLK_adj * weightcurve) / weight_sums
PF_wt <- (adj_gxg$PF_adj * weightcurve) / weight_sums
eFG_wt <- (adj_gxg$eFG_adj * weightcurve) / weight_sums
TS_wt <- (adj_gxg$TS_adj * weightcurve) / weight_sums
Pace_wt <- (adj_gxg$Pace_adj * weightcurve) / weight_sums
ORtg_wt <- (adj_gxg$ORtg_adj * weightcurve) / weight_sums
DRtg_wt <- (adj_gxg$DRtg_adj * weightcurve) / weight_sums
oFG_wt <- (adj_gxg$oFG_adj * weightcurve) / weight_sums
oSR2_wt <- (adj_gxg$oSR2_adj * weightcurve) / weight_sums
oFG3_wt <- (adj_gxg$oFG3_adj * weightcurve) / weight_sums
oSR3_wt <- (adj_gxg$oSR3_adj * weightcurve) / weight_sums
oFT_wt <- (adj_gxg$oFT_adj * weightcurve) / weight_sums
oFTR_wt <- (adj_gxg$oFTR_adj * weightcurve) / weight_sums
oORB_wt <- (adj_gxg$oORB_adj * weightcurve) / weight_sums
oDRB_wt <- (adj_gxg$oDRB_adj * weightcurve) / weight_sums
oTRB_wt <- (adj_gxg$oTRB_adj * weightcurve) / weight_sums
oAST_wt <- (adj_gxg$oAST_adj * weightcurve) / weight_sums
oTO_wt <- (adj_gxg$oTO_adj * weightcurve) / weight_sums
oSTL_wt <- (adj_gxg$oSTL_adj * weightcurve) / weight_sums
oBLK_wt <- (adj_gxg$oBLK_adj * weightcurve) / weight_sums
oPF_wt <- (adj_gxg$oPF_adj * weightcurve) / weight_sums
oeFG_wt <- (adj_gxg$oeFG_adj * weightcurve) / weight_sums
oTS_wt <- (adj_gxg$oTS_adj * weightcurve) / weight_sums
FG_wt <- sum(FG_wt)
SR2_wt <- sum(SR2_wt)
FG3_wt <- sum(FG3_wt)
SR3_wt <- sum(SR3_wt)
FT_wt <- sum(FT_wt)
FTR_wt <- sum(FTR_wt)
ORB_wt <- sum(ORB_wt)
DRB_wt <- sum(DRB_wt)
TRB_wt <- sum(TRB_wt)
AST_wt <- sum(AST_wt)
TO_wt <- sum(TO_wt)
STL_wt <- sum(STL_wt)
BLK_wt <- sum(BLK_wt)
PF_wt <- sum(PF_wt)
eFG_wt <- sum(eFG_wt)
TS_wt <- sum(TS_wt)
Pace_wt <- sum(Pace_wt)
ORtg_wt <- sum(ORtg_wt)
DRtg_wt <- sum(DRtg_wt)
oFG_wt <- sum(oFG_wt)
oSR2_wt <- sum(oSR2_wt)
oFG3_wt <- sum(oFG3_wt)
oSR3_wt <- sum(oSR3_wt)
oFT_wt <- sum(oFT_wt)
oFTR_wt <- sum(oFTR_wt)
oORB_wt <- sum(oORB_wt)
oDRB_wt <- sum(oDRB_wt)
oTRB_wt <- sum(oTRB_wt)
oAST_wt <- sum(oAST_wt)
oTO_wt <- sum(oTO_wt)
oSTL_wt <- sum(oSTL_wt)
oBLK_wt <- sum(oBLK_wt)
oPF_wt <- sum(oPF_wt)
oeFG_wt <- sum(oeFG_wt)
oTS_wt <- sum(oTS_wt)
wt_df <- data.frame(act_id,FG_wt,SR2_wt,FG3_wt,SR3_wt,FT_wt,
FTR_wt,ORB_wt,DRB_wt,TRB_wt,AST_wt,TO_wt,
STL_wt,BLK_wt,PF_wt,eFG_wt,TS_wt,oFG_wt,oSR2_wt,oFG3_wt,oSR3_wt,
oFT_wt,oFTR_wt,oORB_wt,oDRB_wt,oTRB_wt,oAST_wt,
oTO_wt,oSTL_wt,oBLK_wt,oPF_wt,oeFG_wt,oTS_wt,
ORtg_wt,DRtg_wt,Pace_wt)
wt_holder_home <- bind_rows(wt_holder_home,wt_df)
}
home_final_wt <- wt_holder_home
colnames(home_final_wt) <- c("Team","FG","SR2","FG3","SR3","FT","FTR","ORB","DRB","TRB",
"AST","TO","STL","BLK","PF","eFG","TS",
"oFG","oSR2","oFG3","oSR3","oFT","oFTR","oORB","oDRB","oTRB",
"oAST","oTO","oSTL","oBLK","oPF","oeFG","oTS",
"ORtg","DRtg","Pace")
##### WEIGHTING - SEASON ####
wt_holder_season <- data.frame()
a <- 1
g <- nrow(season_final)
for (a in a:g) {
act_id <- as.character(season_final[a,1])
adj_gxg <- season_uw %>%
filter(teamName == act_id)
ngames <- nrow(adj_gxg)
if (ngames > 20) { weightmax <- 4 } else { weightmax <- 1 + ((ngames - 1) * .157894737)  }
weightmin <- 1
weightdist <- (weightmax - weightmin) / (ngames - 1)
if (ngames < 2) { weightdist <- 0 }
weightcurve <- matrix(0, nrow = ngames, ncol = 1)
c <- 1
i <- nrow(weightcurve)
for (c in c:i) {
weightcurve[c] <- weightmin + ((c - 1) * weightdist)
}
weight_sums <- sum(weightcurve)
weight_avg <- mean(weightcurve)
FG_wt <- (adj_gxg$FG_adj * weightcurve) / weight_sums
SR2_wt <- (adj_gxg$SR2_adj * weightcurve) / weight_sums
FG3_wt <- (adj_gxg$FG3_adj * weightcurve) / weight_sums
SR3_wt <- (adj_gxg$SR3_adj * weightcurve) / weight_sums
FT_wt <- (adj_gxg$FT_adj * weightcurve) / weight_sums
FTR_wt <- (adj_gxg$FTR_adj * weightcurve) / weight_sums
ORB_wt <- (adj_gxg$ORB_adj * weightcurve) / weight_sums
DRB_wt <- (adj_gxg$DRB_adj * weightcurve) / weight_sums
TRB_wt <- (adj_gxg$TRB_adj * weightcurve) / weight_sums
AST_wt <- (adj_gxg$AST_adj * weightcurve) / weight_sums
TO_wt <- (adj_gxg$TO_adj * weightcurve) / weight_sums
STL_wt <- (adj_gxg$STL_adj * weightcurve) / weight_sums
BLK_wt <- (adj_gxg$BLK_adj * weightcurve) / weight_sums
PF_wt <- (adj_gxg$PF_adj * weightcurve) / weight_sums
eFG_wt <- (adj_gxg$eFG_adj * weightcurve) / weight_sums
TS_wt <- (adj_gxg$TS_adj * weightcurve) / weight_sums
Pace_wt <- (adj_gxg$Pace_adj * weightcurve) / weight_sums
ORtg_wt <- (adj_gxg$ORtg_adj * weightcurve) / weight_sums
DRtg_wt <- (adj_gxg$DRtg_adj * weightcurve) / weight_sums
oFG_wt <- (adj_gxg$oFG_adj * weightcurve) / weight_sums
oSR2_wt <- (adj_gxg$oSR2_adj * weightcurve) / weight_sums
oFG3_wt <- (adj_gxg$oFG3_adj * weightcurve) / weight_sums
oSR3_wt <- (adj_gxg$oSR3_adj * weightcurve) / weight_sums
oFT_wt <- (adj_gxg$oFT_adj * weightcurve) / weight_sums
oFTR_wt <- (adj_gxg$oFTR_adj * weightcurve) / weight_sums
oORB_wt <- (adj_gxg$oORB_adj * weightcurve) / weight_sums
oDRB_wt <- (adj_gxg$oDRB_adj * weightcurve) / weight_sums
oTRB_wt <- (adj_gxg$oTRB_adj * weightcurve) / weight_sums
oAST_wt <- (adj_gxg$oAST_adj * weightcurve) / weight_sums
oTO_wt <- (adj_gxg$oTO_adj * weightcurve) / weight_sums
oSTL_wt <- (adj_gxg$oSTL_adj * weightcurve) / weight_sums
oBLK_wt <- (adj_gxg$oBLK_adj * weightcurve) / weight_sums
oPF_wt <- (adj_gxg$oPF_adj * weightcurve) / weight_sums
oeFG_wt <- (adj_gxg$oeFG_adj * weightcurve) / weight_sums
oTS_wt <- (adj_gxg$oTS_adj * weightcurve) / weight_sums
FG_wt <- sum(FG_wt)
SR2_wt <- sum(SR2_wt)
FG3_wt <- sum(FG3_wt)
SR3_wt <- sum(SR3_wt)
FT_wt <- sum(FT_wt)
FTR_wt <- sum(FTR_wt)
ORB_wt <- sum(ORB_wt)
DRB_wt <- sum(DRB_wt)
TRB_wt <- sum(TRB_wt)
AST_wt <- sum(AST_wt)
TO_wt <- sum(TO_wt)
STL_wt <- sum(STL_wt)
BLK_wt <- sum(BLK_wt)
PF_wt <- sum(PF_wt)
eFG_wt <- sum(eFG_wt)
TS_wt <- sum(TS_wt)
Pace_wt <- sum(Pace_wt)
ORtg_wt <- sum(ORtg_wt)
DRtg_wt <- sum(DRtg_wt)
oFG_wt <- sum(oFG_wt)
oSR2_wt <- sum(oSR2_wt)
oFG3_wt <- sum(oFG3_wt)
oSR3_wt <- sum(oSR3_wt)
oFT_wt <- sum(oFT_wt)
oFTR_wt <- sum(oFTR_wt)
oORB_wt <- sum(oORB_wt)
oDRB_wt <- sum(oDRB_wt)
oTRB_wt <- sum(oTRB_wt)
oAST_wt <- sum(oAST_wt)
oTO_wt <- sum(oTO_wt)
oSTL_wt <- sum(oSTL_wt)
oBLK_wt <- sum(oBLK_wt)
oPF_wt <- sum(oPF_wt)
oeFG_wt <- sum(oeFG_wt)
oTS_wt <- sum(oTS_wt)
wt_df <- data.frame(act_id,FG_wt,SR2_wt,FG3_wt,SR3_wt,FT_wt,
FTR_wt,ORB_wt,DRB_wt,TRB_wt,AST_wt,TO_wt,
STL_wt,BLK_wt,PF_wt,eFG_wt,TS_wt,oFG_wt,oSR2_wt,oFG3_wt,oSR3_wt,
oFT_wt,oFTR_wt,oORB_wt,oDRB_wt,oTRB_wt,oAST_wt,
oTO_wt,oSTL_wt,oBLK_wt,oPF_wt,oeFG_wt,oTS_wt,
ORtg_wt,DRtg_wt,Pace_wt)
wt_holder_season <- bind_rows(wt_holder_season,wt_df)
}
season_final_wt <- wt_holder_season
colnames(season_final_wt) <- c("Team","FG","SR2","FG3","SR3","FT","FTR","ORB","DRB","TRB",
"AST","TO","STL","BLK","PF","eFG","TS",
"oFG","oSR2","oFG3","oSR3","oFT","oFTR","oORB","oDRB","oTRB",
"oAST","oTO","oSTL","oBLK","oPF","oeFG","oTS",
"ORtg","DRtg","Pace")
##### Attach to game by game df ####
##### Scores Only ####
scores <- game_range %>%
select(13,8,62,17,90,45)
scores <- scores %>%
filter(locationGame.x == "H" & dateGame.x ==  gm_day_gxg)
colnames(scores) <- c("Date", "Loc", "Away", "Home", "AS", "HS")
scores <- left_join(scores, away_final_wt, by = c("Away" = "Team")) %>%
left_join(., home_final_wt, by = c("Home" = "Team"))
colnames(scores)[7:76] <- c("FG_away","SR2_away","FG3_away","SR3_away","FT_away","FTR_away",
"ORB_away","DRB_away","TRB_away","AST_away","TO_away","STL_away",
"BLK_away","PF_away","eFG_away","TS_away",
"oFG_away","oSR2away","oFG3_away","oSR3_away","oFT_away","oFTR_away",
"oORB_away","oDRB_away","oTRB_away","oAST_away","oTO_away","oSTL_away",
"oBLK_away","oPF_away","oeFG_away","oTS_away",
"ORtg_away","DRtg_away","Pace_away",
"FG_home","SR2_home","FG3_home","SR3_home","FT_home","FTR_home",
"ORB_home","DRB_home","TRB_home","AST_home","TO_home","STL_home",
"BLK_home","PF_home","eFG_home","TS_home",
"oFG_home","oSR2home","oFG3_home","oSR3_home","oFT_home","oFTR_home",
"oORB_home","oDRB_home","oTRB_home","oAST_home","oTO_home","oSTL_home",
"oBLK_home","oPF_home","oeFG_home","oTS_home",
"ORtg_home","DRtg_home","Pace_home")
# Kendall
kendall_away_oe <- as.numeric(unlist(scores[,39]))
kendall_away_de <- as.numeric(unlist(scores[,40]))
kendall_away_pa <- as.numeric(unlist(scores[,41]))
kendall_home_oe <- as.numeric(unlist(scores[,74]))
kendall_home_de <- as.numeric(unlist(scores[,75]))
kendall_home_pa <- as.numeric(unlist(scores[,76]))
lg_pace <- as.numeric(league_avg[1,36])
lg_oe <- as.numeric(league_avg[1, 34])
away_pace_vslg <- kendall_away_pa - lg_pace
home_pace_vslg <- kendall_home_pa - lg_pace
vslg_sums <- away_pace_vslg + home_pace_vslg
expected_pace <- (lg_pace + vslg_sums)
away_oe_vslg <- kendall_away_oe - lg_oe
away_de_vslg <- kendall_away_de - lg_oe
home_oe_vslg <- kendall_home_oe - lg_oe
home_de_vslg <- kendall_home_de - lg_oe
away_oe_vslgsums <- away_oe_vslg + home_de_vslg
home_oe_vslgsums <- home_oe_vslg + away_de_vslg
away_proj_oe <- lg_oe + away_oe_vslgsums
home_proj_oe <- lg_oe + home_oe_vslgsums
away_proj_oe <- away_proj_oe / 100
home_proj_oe <- home_proj_oe / 100
away_kendall_score <- as.data.frame((away_proj_oe * expected_pace))
home_kendall_score <- as.data.frame((home_proj_oe * expected_pace))
away_kendall_win <- as.data.frame((away_proj_oe ^ 14.23) / ((away_proj_oe ^ 14.23) + (home_proj_oe ^ 14.23)))
home_kendall_win <- as.data.frame(1 - away_kendall_win)
scores <- bind_cols(scores,away_kendall_score, home_kendall_score, away_kendall_win, home_kendall_win)
colnames(scores)[77:80] <- c("away_kendall_score", "home_kendall_score", "away_kendall_win", "home_kendall_win")
# Tyra fitting
master_reg <- read_xlsx("/Users/Jesse/Documents/MyStuff/NBA Betting/NBAdb/NBAdb1721.xlsx")
master_reg <- master_reg %>%
filter(Date <= head(scores$Date, n = 1))
master_reg <- master_reg[5:78]
# ascore_fit <- lm(AS ~ ORtg_away + DRtg_away + Pace_away + eFG_away + ORB_away +
#                          TO_away + FTR_away + oeFG_away + DRB_away + oTO_away +
#                          oFTR_away + ORtg_home + DRtg_home + Pace_home + eFG_home + ORB_home +
#                          TO_home + FTR_home + oeFG_home + DRB_home + oTO_home +
#                          oFTR_home, data = master_reg)
#
# hscore_fit <- lm(HS ~ ORtg_away + DRtg_away + Pace_away + eFG_away + ORB_away +
#                      TO_away + FTR_away + oeFG_away + DRB_away + oTO_away +
#                      oFTR_away + ORtg_home + DRtg_home + Pace_home + eFG_home + ORB_home +
#                      TO_home + FTR_home + oeFG_home + DRB_home + oTO_home +
#                      oFTR_home, data = master_reg)
#
# win_fit <- glm(Win ~ ORtg_away + DRtg_away + Pace_away + eFG_away + ORB_away +
#                    TO_away + FTR_away + oeFG_away + DRB_away + oTO_away +
#                    oFTR_away + ORtg_home + DRtg_home + Pace_home + eFG_home + ORB_home +
#                    TO_home + FTR_home + oeFG_home + DRB_home + oTO_home +
#                    oFTR_home, data = master_reg, family = "binomial")
ascore_fit <- lm(AS ~ ORtg_away + DRtg_away + Pace_away + eFG_away + ORB_away +
TO_away + FTR_away + oeFG_away + DRB_away + oTO_away +
oFTR_away + ORtg_home + DRtg_home + Pace_home + eFG_home + ORB_home +
TO_home + FTR_home + oeFG_home + DRB_home + oTO_home +
oFTR_home, data = master_reg)
hscore_fit <- lm(HS ~ ORtg_away + DRtg_away + Pace_away + eFG_away + ORB_away +
TO_away + FTR_away + oeFG_away + DRB_away + oTO_away +
oFTR_away + ORtg_home + DRtg_home + Pace_home + eFG_home + ORB_home +
TO_home + FTR_home + oeFG_home + DRB_home + oTO_home +
oFTR_home, data = master_reg)
win_fit <- glm(Win ~ ORtg_away + DRtg_away + Pace_away + eFG_away + ORB_away +
TO_away + FTR_away + oeFG_away + DRB_away + oTO_away +
oFTR_away + ORtg_home + DRtg_home + Pace_home + eFG_home + ORB_home +
TO_home + FTR_home + oeFG_home + DRB_home + oTO_home +
oFTR_home, data = master_reg, family = "binomial")
# tyra
tyra_away_oe <- as.numeric(unlist(scores[,39]))
tyra_away_de <- as.numeric(unlist(scores[,40]))
tyra_away_pa <- as.numeric(unlist(scores[,41]))
tyra_home_oe <- as.numeric(unlist(scores[,74]))
tyra_home_de <- as.numeric(unlist(scores[,75]))
tyra_home_pa <- as.numeric(unlist(scores[,76]))
tyra_away_efg <- as.numeric(unlist(scores[,21]))
tyra_away_ftr <- as.numeric(unlist(scores[,12]))
tyra_away_orb <- as.numeric(unlist(scores[,13]))
tyra_away_to <- as.numeric(unlist(scores[,17]))
tyra_away_oefg <- as.numeric(unlist(scores[,37]))
tyra_away_oftr <- as.numeric(unlist(scores[,28]))
tyra_away_drb <- as.numeric(unlist(scores[,14]))
tyra_away_oto <- as.numeric(unlist(scores[,33]))
tyra_home_efg <- as.numeric(unlist(scores[,56]))
tyra_home_ftr <- as.numeric(unlist(scores[,47]))
tyra_home_orb <- as.numeric(unlist(scores[,48]))
tyra_home_to <- as.numeric(unlist(scores[,52]))
tyra_home_oefg <- as.numeric(unlist(scores[,72]))
tyra_home_oftr <- as.numeric(unlist(scores[,63]))
tyra_home_drb <- as.numeric(unlist(scores[,49]))
tyra_home_oto <- as.numeric(unlist(scores[,68]))
tyra_input <- data.frame(tyra_away_oe,tyra_away_de,tyra_away_pa,
tyra_away_efg,tyra_away_ftr,tyra_away_orb,tyra_away_to,
tyra_away_oefg,tyra_away_oftr,tyra_away_drb,tyra_away_oto,
tyra_home_oe,tyra_home_de,tyra_home_pa,
tyra_home_efg,tyra_home_ftr,tyra_home_orb,tyra_home_to,
tyra_home_oefg,tyra_home_oftr,tyra_home_drb,tyra_home_oto)
colnames(tyra_input) <- c("ORtg_away","DRtg_away","Pace_away",
"eFG_away","FTR_away","ORB_away","TO_away",
"oeFG_away","oFTR_away","DRB_away","oTO_away",
"ORtg_home","DRtg_home","Pace_home",
"eFG_home","FTR_home","ORB_home","TO_home",
"oeFG_home","oFTR_home","DRB_home","oTO_home")
away_tyra_score <- as.numeric(predict(ascore_fit, newdata = tyra_input, type = "response"))
home_tyra_score <- as.numeric(predict(hscore_fit, newdata = tyra_input, type = "response"))
away_tyra_win <- as.numeric(predict(win_fit, newdata = tyra_input, type = "response"))
home_tyra_win <- 1 - away_tyra_win
scores <- bind_cols(scores,away_tyra_score, home_tyra_score, away_tyra_win, home_tyra_win)
colnames(scores)[81:84] <- c("away_tyra_score", "home_tyra_score", "away_tyra_win", "home_tyra_win")
final_db <- bind_rows(final_db,scores)
print(paste(tail(final_db$Date, n = 1), "Complete"))
}
final_db$Date <- as.character(final_db$Date)
final_db <- final_db %>%
select(1:6, 77:84)
nba <- read_xlsx("/Users/Jesse/Documents/MyStuff/NBA Betting/Database Backup/NBAodds_test.xlsx")
nba_away <- nba %>%
filter(AH == "A")
final_db <- inner_join(final_db, nba_away, by = c("Date" = "dateGame", "Away" = "Team"))
nba_home <- nba %>%
filter(AH == "H")
final_db <- inner_join(final_db, nba_home, by = c("Date" = "dateGame", "Home" = "Team"))
final_db <- final_db %>%
select(1:14, 16, 17, 19, 20)
colnames(final_db)[15:18] <- c("spread_away", "ml_away", "spread_home", "ml_home")
final_db <- final_db %>%
mutate(away_marg_kendall = away_kendall_score - home_kendall_score) %>%
mutate(home_marg_kendall = home_kendall_score - away_kendall_score) %>%
# mutate(Kendall_marg_edge)
# mutate(kendall_win_edge)
mutate(away_marg_tyra = away_tyra_score - home_tyra_score) %>%
mutate(home_marg_tyra = home_tyra_score - away_tyra_score) %>%
mutate(gameNum = row_number(Date))
View(final_db)
final_db_home <- final_db %>%
select(23, 1:4, 17, 18, 20, 10, 22, 14, 5, 6)
colnames(final_db_home) <- c("gameNum", "Date", "Loc", "oppTeam", "Team", "Spread", "ML", "Kendall_Marg", "Kendall_Win",
"Tyra_Marg", "Tyra_Win", "oppScore", "Score")
final_db_away <- final_db %>%
select(23, 1, 4, 3, 15, 16, 19, 9, 21, 13, 6, 5) %>%
mutate(Loc = "A") %>%
select(1, 2, 13, 3:12)
colnames(final_db_away) <- c("gameNum", "Date", "Loc", "oppTeam", "Team", "Spread", "ML", "Kendall_Marg", "Kendall_Win",
"Tyra_Marg", "Tyra_Win", "oppScore", "Score")
final_results <- bind_rows(final_db_home, final_db_away)
View(final_results)
final_results <- final_results %>%
mutate(Margin = Score - oppScore) %>%
mutate(ATS_Margin = Margin + Spread) %>%
mutate(ATS_Result = if_else((Margin + Spread) == 0, 0, if_else(ATS_Margin > 0, 1, -1.1))) %>%
mutate(ML_Results = case_when(ML > 0 & (Score - oppScore) > 0 ~ ML/100,
ML > 0 & (Score - oppScore) < 0 ~ -1,
(Score - oppScore) > 0 ~ 1,
(Score - oppScore) < 0 ~ ML/100
)) %>%
arrange(Date, gameNum)
View(final_results)
final_results_perf <- final_results %>%
mutate(Kendall_Marg_Perf = as.numeric(ifelse(Kendall_Marg - Spread * -1 > 0, ATS_Result, ""))) %>%
mutate(Kendall_Win_Perf = as.numeric(ifelse((Kendall_Win - ifelse(ML < 0, ML*-1/(ML*-1+100), 100/(ML+100)) > 0),
ML_Results, ""))) %>%
mutate(Tyra_Marg_Perf = as.numeric(ifelse(Tyra_Marg - Spread * -1 > 0, ATS_Result, ""))) %>%
mutate(Tyra_Win_Perf = as.numeric(ifelse((Tyra_Win - ifelse(ML < 0, ML*-1/(ML*-1+100), 100/(ML+100)) > 0),
ML_Results, ""))) %>%
mutate(Gisele_Marg_Perf = as.numeric(ifelse(Tyra_Marg - Spread * -1 > 0 & Kendall_Marg - Spread * -1  > 0, ATS_Result, ""))) %>%
mutate(Gisele_Win_Perf = as.numeric(ifelse((Tyra_Win - ifelse(ML < 0, ML*-1/(ML*-1+100), 100/(ML+100)) > 0 & Kendall_Win - ifelse(ML < 0, ML*-1/(ML*-1+100), 100/(ML+100)) > 0),
ML_Results, "")))
View(final_results_perf)
final_results_summary <- list()
final_results_summary$Kendall_Marg <- sum(final_results_perf$Kendall_Marg_Perf, na.rm = T)
final_results_summary$Kendall_Win <- sum(final_results_perf$Kendall_Win_Perf, na.rm = T)
final_results_summary$Tyra_Marg <- sum(final_results_perf$Tyra_Marg_Perf, na.rm = T)
final_results_summary$Tyra_Win <- sum(final_results_perf$Tyra_Win_Perf, na.rm = T)
final_results_summary$Gisele_Marg <- sum(final_results_perf$Gisele_Marg_Perf, na.rm = T)
final_results_summary$Gisele_Win <- sum(final_results_perf$Gisele_Win_Perf, na.rm = T)
final_results_summary <- as.data.frame(final_results_summary)
View(final_results_summary)
final_results_perf_analysis <- final_results_perf %>%
mutate(SeasonYear = ifelse(Date <= "2019-04-10", 2019,
ifelse(Date > "2019-04-10" & Date < "2020-08-14", 2020, 2021))) %>%
select(1, 24, 2:23)
View(final_results_perf_analysis)
