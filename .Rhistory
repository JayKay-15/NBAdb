filter(teamLoc == "A") %>%
group_by(teamName) %>%
summarise(across(where(is.numeric), mean))
######### ROUND 2 ADJUSTMENTS ########
#Joining for oppt stats
raw_adj_home_2 <- raw_final %>%
left_join(away_adj_round_1, by = c("opptName" = "teamName")) %>%
left_join(., home_adj_round_1, by = c("teamName" = "teamName")) %>%
filter(teamLoc == "H")
#Joining for team stats
raw_adj_away_2 <- raw_final %>%
left_join(home_adj_round_1, by = c("opptName" = "teamName")) %>%
left_join(., away_adj_round_1, by = c("teamName" = "teamName")) %>%
filter(teamLoc == "A")
raw_adj_2 <- bind_rows(raw_adj_home_2,raw_adj_away_2)
#.x = oppt avg, .y = team avg, no tail = game actual
raw_adj_2$FG_adj <- (raw_adj_2$FG - (raw_adj_2$oFG_adj.x - season_lg_avg$FG))
raw_adj_2$SR2_adj <- (raw_adj_2$SR2 - (raw_adj_2$oSR2_adj.x - season_lg_avg$SR2))
raw_adj_2$FG3_adj <- (raw_adj_2$FG3 - (raw_adj_2$oFG3_adj.x - season_lg_avg$FG3 ))
raw_adj_2$SR3_adj <- (raw_adj_2$SR3 - (raw_adj_2$oSR3_adj.x - season_lg_avg$SR3))
raw_adj_2$FT_adj <- (raw_adj_2$FT - (raw_adj_2$oFT_adj.x - season_lg_avg$FT))
raw_adj_2$FTR_adj <- (raw_adj_2$FTR - (raw_adj_2$oFTR_adj.x - season_lg_avg$FTR))
raw_adj_2$ORB_adj <- (raw_adj_2$ORB + (raw_adj_2$oDRB_adj.x - season_lg_avg$DRB))
raw_adj_2$DRB_adj <- (raw_adj_2$DRB - (raw_adj_2$oORB_adj.x - season_lg_avg$ORB))
raw_adj_2$TRB_adj <- (raw_adj_2$TRB + (raw_adj_2$oTRB_adj.x - season_lg_avg$TRB))
raw_adj_2$AST_adj <- (raw_adj_2$AST - (raw_adj_2$oAST_adj.x - season_lg_avg$AST))
raw_adj_2$TOV_adj <- (raw_adj_2$TOV - (raw_adj_2$oTOV_adj.x - season_lg_avg$TOV))
raw_adj_2$STL_adj <- (raw_adj_2$STL - (raw_adj_2$oSTL_adj.x - season_lg_avg$STL))
raw_adj_2$BLK_adj <- (raw_adj_2$BLK - (raw_adj_2$oBLK_adj.x - season_lg_avg$BLK))
raw_adj_2$PF_adj <- (raw_adj_2$PF - (raw_adj_2$oPF_adj.x - season_lg_avg$PF))
raw_adj_2$eFG_adj <- (raw_adj_2$eFG - (raw_adj_2$oeFG_adj.x - season_lg_avg$eFG))
raw_adj_2$TS_adj <- (raw_adj_2$TS - (raw_adj_2$oTS_adj.x - season_lg_avg$TS))
raw_adj_2$ExpPace <- (season_lg_avg$Pace + (raw_adj_2$Pace - season_lg_avg$Pace) +
(raw_adj_2$Pace_adj.x - season_lg_avg$Pace))
raw_adj_2$PaceDiff <- (raw_adj_2$Pace - raw_adj_2$ExpPace)
raw_adj_2$PaceR <- (raw_adj_2$Pace_adj.y / (raw_adj_2$Pace_adj.y + raw_adj_2$Pace_adj.x))
raw_adj_2$oPaceR <- (raw_adj_2$Pace_adj.x / (raw_adj_2$Pace_adj.y + raw_adj_2$Pace_adj.x))
raw_adj_2$Pace_adj <- (raw_adj_2$Pace_adj.y + (raw_adj_2$PaceDiff * raw_adj_2$PaceR))
raw_adj_2$ORtg_adj <- (raw_adj_2$ORtg - (raw_adj_2$DRtg_adj.x - season_lg_avg$DRtg))
raw_adj_2$DRtg_adj <- (raw_adj_2$DRtg - (raw_adj_2$ORtg_adj.x - season_lg_avg$ORtg))
raw_adj_2$oFG_adj <- (raw_adj_2$oFG - (raw_adj_2$FG_adj.y - season_lg_avg$FG))
raw_adj_2$oSR2_adj <- (raw_adj_2$oSR2 - (raw_adj_2$SR2_adj.y - season_lg_avg$SR2))
raw_adj_2$oFG3_adj <- (raw_adj_2$oFG3 - (raw_adj_2$FG3_adj.y - season_lg_avg$FG3 ))
raw_adj_2$oSR3_adj <- (raw_adj_2$oSR3 - (raw_adj_2$SR3_adj.y - season_lg_avg$SR3))
raw_adj_2$oFT_adj <- (raw_adj_2$oFT - (raw_adj_2$FT_adj.y - season_lg_avg$FT))
raw_adj_2$oFTR_adj <- (raw_adj_2$oFTR - (raw_adj_2$FTR_adj.y - season_lg_avg$FTR))
raw_adj_2$oORB_adj <- (raw_adj_2$oORB + (raw_adj_2$DRB_adj.y - season_lg_avg$DRB))
raw_adj_2$oDRB_adj <- (raw_adj_2$oDRB - (raw_adj_2$ORB_adj.y - season_lg_avg$ORB))
raw_adj_2$oTRB_adj <- (raw_adj_2$oTRB + (raw_adj_2$TRB_adj.y - season_lg_avg$TRB))
raw_adj_2$oAST_adj <- (raw_adj_2$oAST - (raw_adj_2$AST_adj.y - season_lg_avg$AST))
raw_adj_2$oTOV_adj <- (raw_adj_2$oTOV - (raw_adj_2$TOV_adj.y - season_lg_avg$TOV))
raw_adj_2$oSTL_adj <- (raw_adj_2$oSTL - (raw_adj_2$STL_adj.y - season_lg_avg$STL))
raw_adj_2$oBLK_adj <- (raw_adj_2$oBLK - (raw_adj_2$BLK_adj.y - season_lg_avg$BLK))
raw_adj_2$oPF_adj <- (raw_adj_2$oPF - (raw_adj_2$PF_adj.y - season_lg_avg$PF))
raw_adj_2$oeFG_adj <- (raw_adj_2$oeFG - (raw_adj_2$eFG_adj.y - season_lg_avg$eFG))
raw_adj_2$oTS_adj <- (raw_adj_2$oTS - (raw_adj_2$TS_adj.y - season_lg_avg$TS))
### GROUP ROUND 2 ADJUSTMENTS
season_adj_round_2 <- raw_adj_2 %>%
select(2,109:124,132:147,130,131,129) %>%
group_by(teamName) %>%
summarise(across(where(is.numeric), mean))
home_adj_round_2 <- raw_adj_2 %>%
select(1,2,109:124,132:147,130,131,129) %>%
filter(teamLoc == "H") %>%
group_by(teamName) %>%
summarise(across(where(is.numeric), mean))
away_adj_round_2 <- raw_adj_2 %>%
select(1,2,109:124,132:147,130,131,129) %>%
filter(teamLoc == "A") %>%
group_by(teamName) %>%
summarise(across(where(is.numeric), mean))
######### ROUND 3 ADJUSTMENTS ########
#Joining for oppt stats
raw_adj_home_3 <- raw_final %>%
left_join(away_adj_round_2, by = c("opptName" = "teamName")) %>%
left_join(., home_adj_round_2, by = c("teamName" = "teamName")) %>%
filter(teamLoc == "H")
#Joining for team stats
raw_adj_away_3 <- raw_final %>%
left_join(home_adj_round_2, by = c("opptName" = "teamName")) %>%
left_join(., away_adj_round_2, by = c("teamName" = "teamName")) %>%
filter(teamLoc == "A")
raw_adj_3 <- bind_rows(raw_adj_home_3,raw_adj_away_3)
#.x = oppt avg, .y = team avg, no tail = game actual
raw_adj_3$FG_adj <- (raw_adj_3$FG - (raw_adj_3$oFG_adj.x - season_lg_avg$FG))
raw_adj_3$SR2_adj <- (raw_adj_3$SR2 - (raw_adj_3$oSR2_adj.x - season_lg_avg$SR2))
raw_adj_3$FG3_adj <- (raw_adj_3$FG3 - (raw_adj_3$oFG3_adj.x - season_lg_avg$FG3 ))
raw_adj_3$SR3_adj <- (raw_adj_3$SR3 - (raw_adj_3$oSR3_adj.x - season_lg_avg$SR3))
raw_adj_3$FT_adj <- (raw_adj_3$FT - (raw_adj_3$oFT_adj.x - season_lg_avg$FT))
raw_adj_3$FTR_adj <- (raw_adj_3$FTR - (raw_adj_3$oFTR_adj.x - season_lg_avg$FTR))
raw_adj_3$ORB_adj <- (raw_adj_3$ORB + (raw_adj_3$oDRB_adj.x - season_lg_avg$DRB))
raw_adj_3$DRB_adj <- (raw_adj_3$DRB - (raw_adj_3$oORB_adj.x - season_lg_avg$ORB))
raw_adj_3$TRB_adj <- (raw_adj_3$TRB + (raw_adj_3$oTRB_adj.x - season_lg_avg$TRB))
raw_adj_3$AST_adj <- (raw_adj_3$AST - (raw_adj_3$oAST_adj.x - season_lg_avg$AST))
raw_adj_3$TOV_adj <- (raw_adj_3$TOV - (raw_adj_3$oTOV_adj.x - season_lg_avg$TOV))
raw_adj_3$STL_adj <- (raw_adj_3$STL - (raw_adj_3$oSTL_adj.x - season_lg_avg$STL))
raw_adj_3$BLK_adj <- (raw_adj_3$BLK - (raw_adj_3$oBLK_adj.x - season_lg_avg$BLK))
raw_adj_3$PF_adj <- (raw_adj_3$PF - (raw_adj_3$oPF_adj.x - season_lg_avg$PF))
raw_adj_3$eFG_adj <- (raw_adj_3$eFG - (raw_adj_3$oeFG_adj.x - season_lg_avg$eFG))
raw_adj_3$TS_adj <- (raw_adj_3$TS - (raw_adj_3$oTS_adj.x - season_lg_avg$TS))
raw_adj_3$ExpPace <- (season_lg_avg$Pace + (raw_adj_3$Pace - season_lg_avg$Pace) +
(raw_adj_3$Pace_adj.x - season_lg_avg$Pace))
raw_adj_3$PaceDiff <- (raw_adj_3$Pace - raw_adj_3$ExpPace)
raw_adj_3$PaceR <- (raw_adj_3$Pace_adj.y / (raw_adj_3$Pace_adj.y + raw_adj_3$Pace_adj.x))
raw_adj_3$oPaceR <- (raw_adj_3$Pace_adj.x / (raw_adj_3$Pace_adj.y + raw_adj_3$Pace_adj.x))
raw_adj_3$Pace_adj <- (raw_adj_3$Pace_adj.y + (raw_adj_3$PaceDiff * raw_adj_3$PaceR))
raw_adj_3$ORtg_adj <- (raw_adj_3$ORtg - (raw_adj_3$DRtg_adj.x - season_lg_avg$DRtg))
raw_adj_3$DRtg_adj <- (raw_adj_3$DRtg - (raw_adj_3$ORtg_adj.x - season_lg_avg$ORtg))
raw_adj_3$oFG_adj <- (raw_adj_3$oFG - (raw_adj_3$FG_adj.y - season_lg_avg$FG))
raw_adj_3$oSR2_adj <- (raw_adj_3$oSR2 - (raw_adj_3$SR2_adj.y - season_lg_avg$SR2))
raw_adj_3$oFG3_adj <- (raw_adj_3$oFG3 - (raw_adj_3$FG3_adj.y - season_lg_avg$FG3 ))
raw_adj_3$oSR3_adj <- (raw_adj_3$oSR3 - (raw_adj_3$SR3_adj.y - season_lg_avg$SR3))
raw_adj_3$oFT_adj <- (raw_adj_3$oFT - (raw_adj_3$FT_adj.y - season_lg_avg$FT))
raw_adj_3$oFTR_adj <- (raw_adj_3$oFTR - (raw_adj_3$FTR_adj.y - season_lg_avg$FTR))
raw_adj_3$oORB_adj <- (raw_adj_3$oORB + (raw_adj_3$DRB_adj.y - season_lg_avg$DRB))
raw_adj_3$oDRB_adj <- (raw_adj_3$oDRB - (raw_adj_3$ORB_adj.y - season_lg_avg$ORB))
raw_adj_3$oTRB_adj <- (raw_adj_3$oTRB + (raw_adj_3$TRB_adj.y - season_lg_avg$TRB))
raw_adj_3$oAST_adj <- (raw_adj_3$oAST - (raw_adj_3$AST_adj.y - season_lg_avg$AST))
raw_adj_3$oTOV_adj <- (raw_adj_3$oTOV - (raw_adj_3$TOV_adj.y - season_lg_avg$TOV))
raw_adj_3$oSTL_adj <- (raw_adj_3$oSTL - (raw_adj_3$STL_adj.y - season_lg_avg$STL))
raw_adj_3$oBLK_adj <- (raw_adj_3$oBLK - (raw_adj_3$BLK_adj.y - season_lg_avg$BLK))
raw_adj_3$oPF_adj <- (raw_adj_3$oPF - (raw_adj_3$PF_adj.y - season_lg_avg$PF))
raw_adj_3$oeFG_adj <- (raw_adj_3$oeFG - (raw_adj_3$eFG_adj.y - season_lg_avg$eFG))
raw_adj_3$oTS_adj <- (raw_adj_3$oTS - (raw_adj_3$TS_adj.y - season_lg_avg$TS))
### GROUP ROUND 3 ADJUSTMENTS
season_adj_round_3 <- raw_adj_3 %>%
select(2,109:124,132:147,130,131,129) %>%
group_by(teamName) %>%
summarise(across(where(is.numeric), mean))
home_adj_round_3 <- raw_adj_3 %>%
select(1,2,109:124,132:147,130,131,129) %>%
filter(teamLoc == "H") %>%
group_by(teamName) %>%
summarise(across(where(is.numeric), mean))
away_adj_round_3 <- raw_adj_3 %>%
select(1,2,109:124,132:147,130,131,129) %>%
filter(teamLoc == "A") %>%
group_by(teamName) %>%
summarise(across(where(is.numeric), mean))
### Weighting Data frames ###
season_uw <- raw_adj_3 %>%
select(2,109:124,132:147,130,131,129)
home_uw <- raw_adj_3 %>%
select(1,2,109:124,132:147,130,131,129) %>%
filter(teamLoc == "H")
away_uw <- raw_adj_3 %>%
select(1,2,109:124,132:147,130,131,129) %>%
filter(teamLoc == "A")
##### WEIGHTING - AWAY ####
wt_holder_away <- data.frame()
a <- 1
g <- nrow(away_final)
for (a in a:g) {
act_id <- as.character(away_final[a,1])
adj_gxg <- away_uw %>%
filter(teamName == act_id)
ngames <- nrow(adj_gxg)
if (ngames > 20) { weightmax <- 4 } else { weightmax <- 1 + ((ngames - 1) * .157894737)  }
weightmin <- 1
weightdist <- (weightmax - weightmin) / (ngames - 1)
if (ngames < 2) { weightdist <- 0 }
weightcurve <- matrix(0, nrow = ngames, ncol = 1)
c <- 1
i <- nrow(weightcurve)
for (c in c:i) {
weightcurve[c] <- weightmin + ((c - 1) * weightdist)
}
weight_sums <- sum(weightcurve)
weight_avg <- mean(weightcurve)
FG_wt <- (adj_gxg$FG_adj * weightcurve) / weight_sums
SR2_wt <- (adj_gxg$SR2_adj * weightcurve) / weight_sums
FG3_wt <- (adj_gxg$FG3_adj * weightcurve) / weight_sums
SR3_wt <- (adj_gxg$SR3_adj * weightcurve) / weight_sums
FT_wt <- (adj_gxg$FT_adj * weightcurve) / weight_sums
FTR_wt <- (adj_gxg$FTR_adj * weightcurve) / weight_sums
ORB_wt <- (adj_gxg$ORB_adj * weightcurve) / weight_sums
DRB_wt <- (adj_gxg$DRB_adj * weightcurve) / weight_sums
TRB_wt <- (adj_gxg$TRB_adj * weightcurve) / weight_sums
AST_wt <- (adj_gxg$AST_adj * weightcurve) / weight_sums
TOV_wt <- (adj_gxg$TOV_adj * weightcurve) / weight_sums
STL_wt <- (adj_gxg$STL_adj * weightcurve) / weight_sums
BLK_wt <- (adj_gxg$BLK_adj * weightcurve) / weight_sums
PF_wt <- (adj_gxg$PF_adj * weightcurve) / weight_sums
eFG_wt <- (adj_gxg$eFG_adj * weightcurve) / weight_sums
TS_wt <- (adj_gxg$TS_adj * weightcurve) / weight_sums
Pace_wt <- (adj_gxg$Pace_adj * weightcurve) / weight_sums
ORtg_wt <- (adj_gxg$ORtg_adj * weightcurve) / weight_sums
DRtg_wt <- (adj_gxg$DRtg_adj * weightcurve) / weight_sums
oFG_wt <- (adj_gxg$oFG_adj * weightcurve) / weight_sums
oSR2_wt <- (adj_gxg$oSR2_adj * weightcurve) / weight_sums
oFG3_wt <- (adj_gxg$oFG3_adj * weightcurve) / weight_sums
oSR3_wt <- (adj_gxg$oSR3_adj * weightcurve) / weight_sums
oFT_wt <- (adj_gxg$oFT_adj * weightcurve) / weight_sums
oFTR_wt <- (adj_gxg$oFTR_adj * weightcurve) / weight_sums
oORB_wt <- (adj_gxg$oORB_adj * weightcurve) / weight_sums
oDRB_wt <- (adj_gxg$oDRB_adj * weightcurve) / weight_sums
oTRB_wt <- (adj_gxg$oTRB_adj * weightcurve) / weight_sums
oAST_wt <- (adj_gxg$oAST_adj * weightcurve) / weight_sums
oTOV_wt <- (adj_gxg$oTOV_adj * weightcurve) / weight_sums
oSTL_wt <- (adj_gxg$oSTL_adj * weightcurve) / weight_sums
oBLK_wt <- (adj_gxg$oBLK_adj * weightcurve) / weight_sums
oPF_wt <- (adj_gxg$oPF_adj * weightcurve) / weight_sums
oeFG_wt <- (adj_gxg$oeFG_adj * weightcurve) / weight_sums
oTS_wt <- (adj_gxg$oTS_adj * weightcurve) / weight_sums
FG_wt <- sum(FG_wt)
SR2_wt <- sum(SR2_wt)
FG3_wt <- sum(FG3_wt)
SR3_wt <- sum(SR3_wt)
FT_wt <- sum(FT_wt)
FTR_wt <- sum(FTR_wt)
ORB_wt <- sum(ORB_wt)
DRB_wt <- sum(DRB_wt)
TRB_wt <- sum(TRB_wt)
AST_wt <- sum(AST_wt)
TOV_wt <- sum(TOV_wt)
STL_wt <- sum(STL_wt)
BLK_wt <- sum(BLK_wt)
PF_wt <- sum(PF_wt)
eFG_wt <- sum(eFG_wt)
TS_wt <- sum(TS_wt)
Pace_wt <- sum(Pace_wt)
ORtg_wt <- sum(ORtg_wt)
DRtg_wt <- sum(DRtg_wt)
oFG_wt <- sum(oFG_wt)
oSR2_wt <- sum(oSR2_wt)
oFG3_wt <- sum(oFG3_wt)
oSR3_wt <- sum(oSR3_wt)
oFT_wt <- sum(oFT_wt)
oFTR_wt <- sum(oFTR_wt)
oORB_wt <- sum(oORB_wt)
oDRB_wt <- sum(oDRB_wt)
oTRB_wt <- sum(oTRB_wt)
oAST_wt <- sum(oAST_wt)
oTOV_wt <- sum(oTOV_wt)
oSTL_wt <- sum(oSTL_wt)
oBLK_wt <- sum(oBLK_wt)
oPF_wt <- sum(oPF_wt)
oeFG_wt <- sum(oeFG_wt)
oTS_wt <- sum(oTS_wt)
wt_df <- data.frame(act_id,FG_wt,SR2_wt,FG3_wt,SR3_wt,FT_wt,
FTR_wt,ORB_wt,DRB_wt,TRB_wt,AST_wt,TOV_wt,
STL_wt,BLK_wt,PF_wt,eFG_wt,TS_wt,oFG_wt,oSR2_wt,oFG3_wt,oSR3_wt,
oFT_wt,oFTR_wt,oORB_wt,oDRB_wt,oTRB_wt,oAST_wt,
oTOV_wt,oSTL_wt,oBLK_wt,oPF_wt,oeFG_wt,oTS_wt,
ORtg_wt,DRtg_wt,Pace_wt)
wt_holder_away <- bind_rows(wt_holder_away,wt_df)
}
away_final_wt <- wt_holder_away
colnames(away_final_wt) <- c("Team","FG","SR2","FG3","SR3","FT","FTR","ORB","DRB","TRB",
"AST","TOV","STL","BLK","PF","eFG","TS",
"oFG","oSR2","oFG3","oSR3","oFT","oFTR","oORB","oDRB","oTRB",
"oAST","oTOV","oSTL","oBLK","oPF","oeFG","oTS",
"ORtg","DRtg","Pace")
##### WEIGHTING - HOME ####
wt_holder_home <- data.frame()
a <- 1
g <- nrow(home_final)
for (a in a:g) {
act_id <- as.character(home_final[a,1])
adj_gxg <- home_uw %>%
filter(teamName == act_id)
ngames <- nrow(adj_gxg)
if (ngames > 20) { weightmax <- 4 } else { weightmax <- 1 + ((ngames - 1) * .157894737)  }
weightmin <- 1
weightdist <- (weightmax - weightmin) / (ngames - 1)
if (ngames < 2) { weightdist <- 0 }
weightcurve <- matrix(0, nrow = ngames, ncol = 1)
c <- 1
i <- nrow(weightcurve)
for (c in c:i) {
weightcurve[c] <- weightmin + ((c - 1) * weightdist)
}
weight_sums <- sum(weightcurve)
weight_avg <- mean(weightcurve)
FG_wt <- (adj_gxg$FG_adj * weightcurve) / weight_sums
SR2_wt <- (adj_gxg$SR2_adj * weightcurve) / weight_sums
FG3_wt <- (adj_gxg$FG3_adj * weightcurve) / weight_sums
SR3_wt <- (adj_gxg$SR3_adj * weightcurve) / weight_sums
FT_wt <- (adj_gxg$FT_adj * weightcurve) / weight_sums
FTR_wt <- (adj_gxg$FTR_adj * weightcurve) / weight_sums
ORB_wt <- (adj_gxg$ORB_adj * weightcurve) / weight_sums
DRB_wt <- (adj_gxg$DRB_adj * weightcurve) / weight_sums
TRB_wt <- (adj_gxg$TRB_adj * weightcurve) / weight_sums
AST_wt <- (adj_gxg$AST_adj * weightcurve) / weight_sums
TOV_wt <- (adj_gxg$TOV_adj * weightcurve) / weight_sums
STL_wt <- (adj_gxg$STL_adj * weightcurve) / weight_sums
BLK_wt <- (adj_gxg$BLK_adj * weightcurve) / weight_sums
PF_wt <- (adj_gxg$PF_adj * weightcurve) / weight_sums
eFG_wt <- (adj_gxg$eFG_adj * weightcurve) / weight_sums
TS_wt <- (adj_gxg$TS_adj * weightcurve) / weight_sums
Pace_wt <- (adj_gxg$Pace_adj * weightcurve) / weight_sums
ORtg_wt <- (adj_gxg$ORtg_adj * weightcurve) / weight_sums
DRtg_wt <- (adj_gxg$DRtg_adj * weightcurve) / weight_sums
oFG_wt <- (adj_gxg$oFG_adj * weightcurve) / weight_sums
oSR2_wt <- (adj_gxg$oSR2_adj * weightcurve) / weight_sums
oFG3_wt <- (adj_gxg$oFG3_adj * weightcurve) / weight_sums
oSR3_wt <- (adj_gxg$oSR3_adj * weightcurve) / weight_sums
oFT_wt <- (adj_gxg$oFT_adj * weightcurve) / weight_sums
oFTR_wt <- (adj_gxg$oFTR_adj * weightcurve) / weight_sums
oORB_wt <- (adj_gxg$oORB_adj * weightcurve) / weight_sums
oDRB_wt <- (adj_gxg$oDRB_adj * weightcurve) / weight_sums
oTRB_wt <- (adj_gxg$oTRB_adj * weightcurve) / weight_sums
oAST_wt <- (adj_gxg$oAST_adj * weightcurve) / weight_sums
oTOV_wt <- (adj_gxg$oTOV_adj * weightcurve) / weight_sums
oSTL_wt <- (adj_gxg$oSTL_adj * weightcurve) / weight_sums
oBLK_wt <- (adj_gxg$oBLK_adj * weightcurve) / weight_sums
oPF_wt <- (adj_gxg$oPF_adj * weightcurve) / weight_sums
oeFG_wt <- (adj_gxg$oeFG_adj * weightcurve) / weight_sums
oTS_wt <- (adj_gxg$oTS_adj * weightcurve) / weight_sums
FG_wt <- sum(FG_wt)
SR2_wt <- sum(SR2_wt)
FG3_wt <- sum(FG3_wt)
SR3_wt <- sum(SR3_wt)
FT_wt <- sum(FT_wt)
FTR_wt <- sum(FTR_wt)
ORB_wt <- sum(ORB_wt)
DRB_wt <- sum(DRB_wt)
TRB_wt <- sum(TRB_wt)
AST_wt <- sum(AST_wt)
TOV_wt <- sum(TOV_wt)
STL_wt <- sum(STL_wt)
BLK_wt <- sum(BLK_wt)
PF_wt <- sum(PF_wt)
eFG_wt <- sum(eFG_wt)
TS_wt <- sum(TS_wt)
Pace_wt <- sum(Pace_wt)
ORtg_wt <- sum(ORtg_wt)
DRtg_wt <- sum(DRtg_wt)
oFG_wt <- sum(oFG_wt)
oSR2_wt <- sum(oSR2_wt)
oFG3_wt <- sum(oFG3_wt)
oSR3_wt <- sum(oSR3_wt)
oFT_wt <- sum(oFT_wt)
oFTR_wt <- sum(oFTR_wt)
oORB_wt <- sum(oORB_wt)
oDRB_wt <- sum(oDRB_wt)
oTRB_wt <- sum(oTRB_wt)
oAST_wt <- sum(oAST_wt)
oTOV_wt <- sum(oTOV_wt)
oSTL_wt <- sum(oSTL_wt)
oBLK_wt <- sum(oBLK_wt)
oPF_wt <- sum(oPF_wt)
oeFG_wt <- sum(oeFG_wt)
oTS_wt <- sum(oTS_wt)
wt_df <- data.frame(act_id,FG_wt,SR2_wt,FG3_wt,SR3_wt,FT_wt,
FTR_wt,ORB_wt,DRB_wt,TRB_wt,AST_wt,TOV_wt,
STL_wt,BLK_wt,PF_wt,eFG_wt,TS_wt,oFG_wt,oSR2_wt,oFG3_wt,oSR3_wt,
oFT_wt,oFTR_wt,oORB_wt,oDRB_wt,oTRB_wt,oAST_wt,
oTOV_wt,oSTL_wt,oBLK_wt,oPF_wt,oeFG_wt,oTS_wt,
ORtg_wt,DRtg_wt,Pace_wt)
wt_holder_home <- bind_rows(wt_holder_home,wt_df)
}
home_final_wt <- wt_holder_home
colnames(home_final_wt) <- c("Team","FG","SR2","FG3","SR3","FT","FTR","ORB","DRB","TRB",
"AST","TOV","STL","BLK","PF","eFG","TS",
"oFG","oSR2","oFG3","oSR3","oFT","oFTR","oORB","oDRB","oTRB",
"oAST","oTOV","oSTL","oBLK","oPF","oeFG","oTS",
"ORtg","DRtg","Pace")
##### WEIGHTING - SEASON ####
wt_holder_season <- data.frame()
a <- 1
g <- nrow(season_final)
for (a in a:g) {
act_id <- as.character(season_final[a,1])
adj_gxg <- season_uw %>%
filter(teamName == act_id)
ngames <- nrow(adj_gxg)
if (ngames > 20) { weightmax <- 4 } else { weightmax <- 1 + ((ngames - 1) * .157894737)  }
weightmin <- 1
weightdist <- (weightmax - weightmin) / (ngames - 1)
if (ngames < 2) { weightdist <- 0 }
weightcurve <- matrix(0, nrow = ngames, ncol = 1)
c <- 1
i <- nrow(weightcurve)
for (c in c:i) {
weightcurve[c] <- weightmin + ((c - 1) * weightdist)
}
weight_sums <- sum(weightcurve)
weight_avg <- mean(weightcurve)
FG_wt <- (adj_gxg$FG_adj * weightcurve) / weight_sums
SR2_wt <- (adj_gxg$SR2_adj * weightcurve) / weight_sums
FG3_wt <- (adj_gxg$FG3_adj * weightcurve) / weight_sums
SR3_wt <- (adj_gxg$SR3_adj * weightcurve) / weight_sums
FT_wt <- (adj_gxg$FT_adj * weightcurve) / weight_sums
FTR_wt <- (adj_gxg$FTR_adj * weightcurve) / weight_sums
ORB_wt <- (adj_gxg$ORB_adj * weightcurve) / weight_sums
DRB_wt <- (adj_gxg$DRB_adj * weightcurve) / weight_sums
TRB_wt <- (adj_gxg$TRB_adj * weightcurve) / weight_sums
AST_wt <- (adj_gxg$AST_adj * weightcurve) / weight_sums
TOV_wt <- (adj_gxg$TOV_adj * weightcurve) / weight_sums
STL_wt <- (adj_gxg$STL_adj * weightcurve) / weight_sums
BLK_wt <- (adj_gxg$BLK_adj * weightcurve) / weight_sums
PF_wt <- (adj_gxg$PF_adj * weightcurve) / weight_sums
eFG_wt <- (adj_gxg$eFG_adj * weightcurve) / weight_sums
TS_wt <- (adj_gxg$TS_adj * weightcurve) / weight_sums
Pace_wt <- (adj_gxg$Pace_adj * weightcurve) / weight_sums
ORtg_wt <- (adj_gxg$ORtg_adj * weightcurve) / weight_sums
DRtg_wt <- (adj_gxg$DRtg_adj * weightcurve) / weight_sums
oFG_wt <- (adj_gxg$oFG_adj * weightcurve) / weight_sums
oSR2_wt <- (adj_gxg$oSR2_adj * weightcurve) / weight_sums
oFG3_wt <- (adj_gxg$oFG3_adj * weightcurve) / weight_sums
oSR3_wt <- (adj_gxg$oSR3_adj * weightcurve) / weight_sums
oFT_wt <- (adj_gxg$oFT_adj * weightcurve) / weight_sums
oFTR_wt <- (adj_gxg$oFTR_adj * weightcurve) / weight_sums
oORB_wt <- (adj_gxg$oORB_adj * weightcurve) / weight_sums
oDRB_wt <- (adj_gxg$oDRB_adj * weightcurve) / weight_sums
oTRB_wt <- (adj_gxg$oTRB_adj * weightcurve) / weight_sums
oAST_wt <- (adj_gxg$oAST_adj * weightcurve) / weight_sums
oTOV_wt <- (adj_gxg$oTOV_adj * weightcurve) / weight_sums
oSTL_wt <- (adj_gxg$oSTL_adj * weightcurve) / weight_sums
oBLK_wt <- (adj_gxg$oBLK_adj * weightcurve) / weight_sums
oPF_wt <- (adj_gxg$oPF_adj * weightcurve) / weight_sums
oeFG_wt <- (adj_gxg$oeFG_adj * weightcurve) / weight_sums
oTS_wt <- (adj_gxg$oTS_adj * weightcurve) / weight_sums
FG_wt <- sum(FG_wt)
SR2_wt <- sum(SR2_wt)
FG3_wt <- sum(FG3_wt)
SR3_wt <- sum(SR3_wt)
FT_wt <- sum(FT_wt)
FTR_wt <- sum(FTR_wt)
ORB_wt <- sum(ORB_wt)
DRB_wt <- sum(DRB_wt)
TRB_wt <- sum(TRB_wt)
AST_wt <- sum(AST_wt)
TOV_wt <- sum(TOV_wt)
STL_wt <- sum(STL_wt)
BLK_wt <- sum(BLK_wt)
PF_wt <- sum(PF_wt)
eFG_wt <- sum(eFG_wt)
TS_wt <- sum(TS_wt)
Pace_wt <- sum(Pace_wt)
ORtg_wt <- sum(ORtg_wt)
DRtg_wt <- sum(DRtg_wt)
oFG_wt <- sum(oFG_wt)
oSR2_wt <- sum(oSR2_wt)
oFG3_wt <- sum(oFG3_wt)
oSR3_wt <- sum(oSR3_wt)
oFT_wt <- sum(oFT_wt)
oFTR_wt <- sum(oFTR_wt)
oORB_wt <- sum(oORB_wt)
oDRB_wt <- sum(oDRB_wt)
oTRB_wt <- sum(oTRB_wt)
oAST_wt <- sum(oAST_wt)
oTOV_wt <- sum(oTOV_wt)
oSTL_wt <- sum(oSTL_wt)
oBLK_wt <- sum(oBLK_wt)
oPF_wt <- sum(oPF_wt)
oeFG_wt <- sum(oeFG_wt)
oTS_wt <- sum(oTS_wt)
wt_df <- data.frame(act_id,FG_wt,SR2_wt,FG3_wt,SR3_wt,FT_wt,
FTR_wt,ORB_wt,DRB_wt,TRB_wt,AST_wt,TOV_wt,
STL_wt,BLK_wt,PF_wt,eFG_wt,TS_wt,oFG_wt,oSR2_wt,oFG3_wt,oSR3_wt,
oFT_wt,oFTR_wt,oORB_wt,oDRB_wt,oTRB_wt,oAST_wt,
oTOV_wt,oSTL_wt,oBLK_wt,oPF_wt,oeFG_wt,oTS_wt,
ORtg_wt,DRtg_wt,Pace_wt)
wt_holder_season <- bind_rows(wt_holder_season,wt_df)
}
season_final_wt <- wt_holder_season
colnames(season_final_wt) <- c("Team","FG","SR2","FG3","SR3","FT","FTR","ORB","DRB","TRB",
"AST","TOV","STL","BLK","PF","eFG","TS",
"oFG","oSR2","oFG3","oSR3","oFT","oFTR","oORB","oDRB","oTRB",
"oAST","oTOV","oSTL","oBLK","oPF","oeFG","oTS",
"ORtg","DRtg","Pace")
##### Attach to game by game df ####
##### Scores Only ####
scores <- game_range %>%
select(13,8,62,17,90,45)
scores <- scores %>%
filter(locationGame.x == "H" & dateGame.x ==  gm_day_gxg)
colnames(scores) <- c("Date", "Loc", "Away", "Home", "AS", "HS")
scores <- left_join(scores, away_final_wt, by = c("Away" = "Team")) %>%
left_join(., home_final_wt, by = c("Home" = "Team"))
colnames(scores)[7:76] <- c("FG_away","SR2_away","FG3_away","SR3_away","FT_away","FTR_away",
"ORB_away","DRB_away","TRB_away","AST_away","TOV_away","STL_away",
"BLK_away","PF_away","eFG_away","TS_away",
"oFG_away","oSR2away","oFG3_away","oSR3_away","oFT_away","oFTR_away",
"oORB_away","oDRB_away","oTRB_away","oAST_away","oTOV_away","oSTL_away",
"oBLK_away","oPF_away","oeFG_away","oTS_away",
"ORtg_away","DRtg_away","Pace_away",
"FG_home","SR2_home","FG3_home","SR3_home","FT_home","FTR_home",
"ORB_home","DRB_home","TRB_home","AST_home","TOV_home","STL_home",
"BLK_home","PF_home","eFG_home","TS_home",
"oFG_home","oSR2home","oFG3_home","oSR3_home","oFT_home","oFTR_home",
"oORB_home","oDRB_home","oTRB_home","oAST_home","oTOV_home","oSTL_home",
"oBLK_home","oPF_home","oeFG_home","oTS_home",
"ORtg_home","DRtg_home","Pace_home")
final_db <- bind_rows(final_db,scores)
print(paste(tail(final_db$Date, n = 1), "Complete"))
}
final_db$Margin <- final_db$AS - final_db$HS
final_db$Win <- if_else(final_db$AS > final_db$HS, 1, 0)
final_db <- final_db %>%
select(1:6,77,78,7:76) %>%
arrange(Date)
##### EXPORT TO EXCEL ######
wb <- createWorkbook()
addWorksheet(wb, sheetName = "final_db")
writeData(wb, sheet = "final_db", x = final_db)
saveWorkbook(wb, file = u)
wb <- createWorkbook()
addWorksheet(wb, sheetName = "final_db")
writeData(wb, sheet = "final_db", x = final_db)
saveWorkbook(wb, file = u)
detach("package:XLConnect", unload = TRUE)
wb <- createWorkbook()
addWorksheet(wb, sheetName = "final_db")
writeData(wb, sheet = "final_db", x = final_db)
View(final_db)
wb <- createWorkbook()
addWorksheet(wb, sheetName = "final_db")
writeData(wb, sheet = "final_db", x = final_db)
saveWorkbook(wb, file = u)
