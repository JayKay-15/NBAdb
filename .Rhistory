filter(season == 2022 & season_type == 2) %>%
group_by(team_id, team_name) %>%
summarise(across(fg2m:mins, TTR::EMA, 20))
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
group_by(team_id, team_name) %>%
summarise(across(fg2m:mins, \(x) TTR::EMA(x, n = 20)))
summarise(across(fg2m:mins, \(x) TTR::EMA(x, n = 5))
df_agg <- df_full %>%
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
group_by(team_id, team_name) %>%
summarise(across(fg2m:mins, \(x) TTR::EMA(x, n = 5)))
install.packages("pracma")
library(pracma)
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
group_by(team_id, team_name) %>%
summarise(across(fg2m:mins, \(x) pracma::movavg(x, n = 5, type = 'e')))
View(df_agg)
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
group_by(team_name) %>%
summarise(across(fg2m:mins, \(x) pracma::movavg(x, n = 5, type = 'e')))
View(df_agg)
View(df_full)
df_agg <- df_full %>%
ungroup() %>%
filter(season == 2022 & season_type == 2) %>%
group_by(team_name) %>%
summarise(across(fg2m:mins, \(x) pracma::movavg(x, n = 5, type = 'e')))
View(df_full)
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(team_name, fg2m:mins) %>%
group_by(team_name) %>%
summarise(across(fg2m:mins, \(x) pracma::movavg(x, n = 5, type = 'e')))
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(team_name, fg2m:mins)
View(df_agg)
any(is.na(df_agg))
df_full <- as.data.frame(df_full)
df_full <- df_team %>%
left_join(df_opp, by = c("game_id" = "game_id", "opp_id" = "team_id"))
df_full <- as.data.frame(df_full)
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(team_name, fg2m:mins) %>%
group_by(team_name) %>%
summarise(across(fg2m:mins, \(x) pracma::movavg(x, n = 5, type = 'e')))
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(team_name, fg2m:mins) %>%
group_by(team_name) %>%
summarise(across(fg2m:mins, \(x) mean(x, n = 5, type = 'e')))
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(team_name, fg2m:mins) %>%
group_by(team_name) %>%
summarise(across(fg2m:mins, \(x) mean(x)))
View(df_agg)
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(team_name, fg2m:mins) %>%
group_by(team_name) %>%
summarise(across(fg2m:mins, \(x) pracma::movavg(x = x, n = 5, type = 'e')))
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(team_name, fg2m:mins) %>%
group_by(team_name) %>%
summarise(across(fg2m:mins, \(x) pracma::movavg(x, n = 5, type = 'e', x = x)))
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(team_name, fg2m:mins) %>%
group_by(team_name) %>%
summarise(across(fg2m:mins, \(x) pracma::movavg(x, type = 'e')))
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(team_name, fg2m:mins) %>%
group_by(team_name) %>%
summarise(across(fg2m:mins, \(x) pracma::movavg(x, n = 5, type = 'e')))
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(team_name, fg2m:mins) %>%
group_by(team_name) %>%
summarise(across(fg2m:mins, pracma::movavg, n = 5, type = 'e'))
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(team_name, fg2m:mins) %>%
group_by(team_name) %>%
summarise(across(fg2m, pracma::movavg, n = 5, type = 'e'))
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(team_name, fg2m:mins) %>%
mutate(across(fg2m:mins, \(x) pracma::movavg(x, n = 5, type = 'e')))
View(df_agg)
View(df_agg)
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(date_game, team_name, fg2m:mins) %>%
mutate(across(fg2m:mins, \(x) pracma::movavg(x, n = 5, type = 'e')))
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(game_date, team_name, fg2m:mins) %>%
mutate(across(fg2m:mins, \(x) pracma::movavg(x, n = 5, type = 'e')))
View(df_agg)
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(team_name, fg2m:mins) %>%
group_by(team_name) %>%
summarise(across(fg2m:mins, \(x) mean(x)))
View(df_agg)
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(game_date, team_name, fg2m:mins) %>%
mutate(across(fg2m:mins, \(x) pracma::movavg(x, n = 20, type = 'e')))
View(df_agg)
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(game_date, team_name, fg2m:mins) %>%
mutate(across(fg2m:mins, \(x) TTR::EMA(x, n = 20)))
View(df_agg)
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(game_date, team_name, fg2m:mins) %>%
mutate(across(fg2m:mins, \(x) pracma::movavg(x, n = 20, type = 'e')))
View(df_agg)
remove.packages("TTR")
View(df_full)
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
select(game_id:opp_score) %>%
mutate(across(fg2m:ncol(), \(x) pracma::movavg(x, n = 20, type = 'e')))
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
mutate(across(fg2m:ncol(), \(x) pracma::movavg(x, n = 20, type = 'e')))
View(df_full)
df_agg <- df_full %>%
filter(season == 2022 & season_type == 2) %>%
mutate(across(fg2m:ncol(.), \(x) pracma::movavg(x, n = 20, type = 'e')))
View(df_agg)
df_agg <- df_full %>%
arrange(desc(game_date), game_id)
View(df_agg)
df_agg <- df_full %>%
arrange(desc(game_date), game_id) %>%
filter(season == 2022 & season_type == 2) %>%
mutate(across(fg2m:ncol(.), \(x) pracma::movavg(x, n = 20, type = 'e')))
View(df_agg)
df_agg <- df_full %>%
arrange(game_date, game_id) %>%
filter(season == 2022 & season_type == 2) %>%
mutate(across(fg2m:ncol(.), \(x) pracma::movavg(x, n = 20, type = 'e')))
View(df_agg)
df_agg <- df_full %>%
arrange(game_date, game_id) %>%
filter(season == 2022 & season_type == 2) %>%
group_by(team_id) %>%
mutate(across(fg2m:ncol(.), \(x) pracma::movavg(x, n = 20, type = 'e')))
View(df_full)
df_agg <- df_full %>%
arrange(game_date, game_id) %>%
filter(season == 2022 & season_type == 2) %>%
group_by(team_id) %>%
mutate(across(fg2m:opp_mins, \(x) pracma::movavg(x, n = 20, type = 'e')))
View(df_agg)
df_agg <- df_full %>%
arrange(game_date, game_id) %>%
filter(season == 2022 & season_type == 2) %>%
group_by(team_id, team_loc) %>%
mutate(across(fg2m:opp_mins, \(x) pracma::movavg(x, n = 20, type = 'e')))
View(df_agg)
df_agg <- df_full %>%
arrange(game_date, game_id) %>%
filter(season == 2022 & season_type == 2) %>%
group_by(team_id, team_loc) %>%
mutate(across(fg2m:opp_mins, \(x) pracma::movavg(x, n = 10, type = 'e')))
df_adv <- df_agg %>%
mutate(
poss = round(fga - oreb + tov + (0.44 * fta),0),
opp_poss = round(opp_fga - opp_oreb + opp_tov + (0.44 * opp_fta),0),
pace = round((poss + opp_poss) * 48 / ((mins/5) * 2),0),
off_rtg = round((team_score/poss) * 100, 1),
def_rtg = round((opp_score/opp_poss) * 100, 1),
fg2m = fgm - fg3m,
fg2a = fga - fg3a,
fg2_pct = fg2m/fg2a,
fg2_sr = (fga-fg2a)/fga,
fg3_pct = fg3m/fg3a,
fg3_sr = (fga-fg3a)/fga,
fg_pct = fgm/fga,
efg_pct = (fg3m*0.5 + fgm)/fga,
ts_pct = team_score/(fga*2 + fta*0.44),
ft_pct = ftm/fta,
ftr = ftm/fga,
oreb_pct = oreb/(oreb+opp_dreb),
dreb_pct = dreb/(dreb+opp_oreb),
treb_pct = treb/(treb+opp_treb),
ast_pct = ast/fgm,
tov_pct = tov/poss,
stl_pct = stl/opp_poss,
blk_pct = blk/(opp_fga-opp_fg3a),
opp_fg2m = opp_fgm - opp_fg3m,
opp_fg2a = opp_fga - opp_fg3a,
opp_fg2_pct = opp_fg2m/opp_fg2a,
opp_fg2_sr = (opp_fga-opp_fg2a)/opp_fga,
opp_fg3_pct = opp_fg3m/opp_fg3a,
opp_fg3_sr = (opp_fga-opp_fg3a)/opp_fga,
opp_fg_pct = opp_fgm/opp_fga,
opp_efg_pct = (opp_fg3m*0.5 + opp_fgm)/opp_fga,
opp_ts_pct = opp_score/(opp_fga*2 + opp_fta*0.44),
opp_ft_pct = opp_ftm/opp_fta,
opp_ftr = opp_ftm/opp_fga,
opp_oreb_pct = opp_oreb/(opp_oreb+dreb),
opp_dreb_pct = opp_dreb/(opp_dreb+oreb),
opp_treb_pct = opp_treb/(treb+opp_treb),
opp_ast_pct = opp_ast/opp_fgm,
opp_tov_pct = opp_tov/opp_poss,
opp_stl_pct = opp_stl/poss,
opp_blk_pct = opp_blk/(fga-fg3a)
)
View(df_adv)
View(df_adv)
View(df_adv)
df_adv <- df_agg %>%
mutate(
poss = round(fga - oreb + tov + (0.44 * fta),0),
opp_poss = round(opp_fga - opp_oreb + opp_tov + (0.44 * opp_fta),0),
pace = round((poss + opp_poss) * 48 / ((mins/5) * 2),0),
off_rtg = round((team_score/poss) * 100, 1),
def_rtg = round((opp_score/opp_poss) * 100, 1),
fg2_pct = fg2m/fg2a,
fg2_sr = (fga-fg2a)/fga,
fg3_pct = fg3m/fg3a,
fg3_sr = (fga-fg3a)/fga,
fg_pct = fgm/fga,
efg_pct = (fg3m*0.5 + fgm)/fga,
ts_pct = team_score/(fga*2 + fta*0.44),
ft_pct = ftm/fta,
ftr = ftm/fga,
oreb_pct = oreb/(oreb+opp_dreb),
dreb_pct = dreb/(dreb+opp_oreb),
treb_pct = treb/(treb+opp_treb),
ast_pct = ast/fgm,
tov_pct = tov/poss,
stl_pct = stl/opp_poss,
blk_pct = blk/(opp_fga-opp_fg3a),
opp_fg2_pct = opp_fg2m/opp_fg2a,
opp_fg2_sr = (opp_fga-opp_fg2a)/opp_fga,
opp_fg3_pct = opp_fg3m/opp_fg3a,
opp_fg3_sr = (opp_fga-opp_fg3a)/opp_fga,
opp_fg_pct = opp_fgm/opp_fga,
opp_efg_pct = (opp_fg3m*0.5 + opp_fgm)/opp_fga,
opp_ts_pct = opp_score/(opp_fga*2 + opp_fta*0.44),
opp_ft_pct = opp_ftm/opp_fta,
opp_ftr = opp_ftm/opp_fga,
opp_oreb_pct = opp_oreb/(opp_oreb+dreb),
opp_dreb_pct = opp_dreb/(opp_dreb+oreb),
opp_treb_pct = opp_treb/(treb+opp_treb),
opp_ast_pct = opp_ast/opp_fgm,
opp_tov_pct = opp_tov/opp_poss,
opp_stl_pct = opp_stl/poss,
opp_blk_pct = opp_blk/(fga-fg3a)
) %>%
select(game_id:opp_score,fg2m,fg2a,fg2_pct,fg2_sr,fg3m,fg3a,fg3_pct,fg3_sr,
fgm,fga,fg_pct,efg_pct,ts_pct,ftm,fta,ft_pct,ftr,oreb,oreb_pct,
dreb,dreb_pct,treb,treb_pct,ast,ast_pct,tov,tov_pct,tov_pts,
stl,stl_pct,blk,blk_pct,poss,opp_pace,pace,off_rtg,def_rtg,
opp_fg2m,opp_fg2a,opp_fg2_pct,opp_fg2_sr,opp_fg3m,opp_fg3a,
opp_fg3_pct,opp_fg3_sr,opp_fgm,opp_fga,opp_fg_pct,opp_efg_pct,
opp_ts_pct,opp_ftm,opp_fta,opp_ft_pct,opp_ftr,opp_oreb,opp_oreb_pct,
opp_dreb,opp_dreb_pct,opp_treb,opp_treb_pct,opp_ast,opp_ast_pct,
opp_tov,opp_tov_pct,opp_tov_pts,opp_stl,opp_stl_pct,opp_blk,opp_blk_pct)
df_adv <- df_agg %>%
mutate(
poss = round(fga - oreb + tov + (0.44 * fta),0),
opp_poss = round(opp_fga - opp_oreb + opp_tov + (0.44 * opp_fta),0),
pace = round((poss + opp_poss) * 48 / ((mins/5) * 2),0),
off_rtg = round((team_score/poss) * 100, 1),
def_rtg = round((opp_score/opp_poss) * 100, 1),
fg2_pct = fg2m/fg2a,
fg2_sr = (fga-fg2a)/fga,
fg3_pct = fg3m/fg3a,
fg3_sr = (fga-fg3a)/fga,
fg_pct = fgm/fga,
efg_pct = (fg3m*0.5 + fgm)/fga,
ts_pct = team_score/(fga*2 + fta*0.44),
ft_pct = ftm/fta,
ftr = ftm/fga,
oreb_pct = oreb/(oreb+opp_dreb),
dreb_pct = dreb/(dreb+opp_oreb),
treb_pct = treb/(treb+opp_treb),
ast_pct = ast/fgm,
tov_pct = tov/poss,
stl_pct = stl/opp_poss,
blk_pct = blk/(opp_fga-opp_fg3a),
opp_fg2_pct = opp_fg2m/opp_fg2a,
opp_fg2_sr = (opp_fga-opp_fg2a)/opp_fga,
opp_fg3_pct = opp_fg3m/opp_fg3a,
opp_fg3_sr = (opp_fga-opp_fg3a)/opp_fga,
opp_fg_pct = opp_fgm/opp_fga,
opp_efg_pct = (opp_fg3m*0.5 + opp_fgm)/opp_fga,
opp_ts_pct = opp_score/(opp_fga*2 + opp_fta*0.44),
opp_ft_pct = opp_ftm/opp_fta,
opp_ftr = opp_ftm/opp_fga,
opp_oreb_pct = opp_oreb/(opp_oreb+dreb),
opp_dreb_pct = opp_dreb/(opp_dreb+oreb),
opp_treb_pct = opp_treb/(treb+opp_treb),
opp_ast_pct = opp_ast/opp_fgm,
opp_tov_pct = opp_tov/opp_poss,
opp_stl_pct = opp_stl/poss,
opp_blk_pct = opp_blk/(fga-fg3a)
) %>%
select(game_id:opp_score,fg2m,fg2a,fg2_pct,fg2_sr,fg3m,fg3a,fg3_pct,fg3_sr,
fgm,fga,fg_pct,efg_pct,ts_pct,ftm,fta,ft_pct,ftr,oreb,oreb_pct,
dreb,dreb_pct,treb,treb_pct,ast,ast_pct,tov,tov_pct,tov_pts,
stl,stl_pct,blk,blk_pct,poss,opp_poss,pace,off_rtg,def_rtg,
opp_fg2m,opp_fg2a,opp_fg2_pct,opp_fg2_sr,opp_fg3m,opp_fg3a,
opp_fg3_pct,opp_fg3_sr,opp_fgm,opp_fga,opp_fg_pct,opp_efg_pct,
opp_ts_pct,opp_ftm,opp_fta,opp_ft_pct,opp_ftr,opp_oreb,opp_oreb_pct,
opp_dreb,opp_dreb_pct,opp_treb,opp_treb_pct,opp_ast,opp_ast_pct,
opp_tov,opp_tov_pct,opp_tov_pts,opp_stl,opp_stl_pct,opp_blk,opp_blk_pct)
View(df_adv)
View(df_adv)
df_adv <- df_agg %>%
mutate(
poss = round(fga - oreb + tov + (0.44 * fta),0),
opp_poss = round(opp_fga - opp_oreb + opp_tov + (0.44 * opp_fta),0),
pace = round((poss + opp_poss) * 48 / ((mins/5) * 2),0),
off_rtg = round((team_score/poss) * 100, 1),
def_rtg = round((opp_score/opp_poss) * 100, 1),
fg2_pct = fg2m/fg2a,
fg2_sr = (fga-fg2a)/fga,
fg3_pct = fg3m/fg3a,
fg3_sr = (fga-fg3a)/fga,
fg_pct = fgm/fga,
efg_pct = (fg3m*0.5 + fgm)/fga,
ts_pct = team_score/(fga*2 + fta*0.44),
ft_pct = ftm/fta,
ftr = ftm/fga,
oreb_pct = oreb/(oreb+opp_dreb),
dreb_pct = dreb/(dreb+opp_oreb),
treb_pct = treb/(treb+opp_treb),
ast_pct = ast/fgm,
tov_pct = tov/poss,
ast_tov_pct = ast/tov,
stl_pct = stl/opp_poss,
blk_pct = blk/(opp_fga-opp_fg3a),
opp_fg2_pct = opp_fg2m/opp_fg2a,
opp_fg2_sr = (opp_fga-opp_fg2a)/opp_fga,
opp_fg3_pct = opp_fg3m/opp_fg3a,
opp_fg3_sr = (opp_fga-opp_fg3a)/opp_fga,
opp_fg_pct = opp_fgm/opp_fga,
opp_efg_pct = (opp_fg3m*0.5 + opp_fgm)/opp_fga,
opp_ts_pct = opp_score/(opp_fga*2 + opp_fta*0.44),
opp_ft_pct = opp_ftm/opp_fta,
opp_ftr = opp_ftm/opp_fga,
opp_oreb_pct = opp_oreb/(opp_oreb+dreb),
opp_dreb_pct = opp_dreb/(opp_dreb+oreb),
opp_treb_pct = opp_treb/(treb+opp_treb),
opp_ast_pct = opp_ast/opp_fgm,
opp_tov_pct = opp_tov/opp_poss,
opp_ast_tov_pct = opp_ast/opp_tov,
opp_stl_pct = opp_stl/poss,
opp_blk_pct = opp_blk/(fga-fg3a)
) %>%
select(game_id:opp_score,fg2m,fg2a,fg2_pct,fg2_sr,fg3m,fg3a,fg3_pct,fg3_sr,
fgm,fga,fg_pct,efg_pct,ts_pct,ftm,fta,ft_pct,ftr,oreb,oreb_pct,
dreb,dreb_pct,treb,treb_pct,ast,ast_pct,tov,tov_pct,tov_pts,ast_tov_pct,
stl,stl_pct,blk,blk_pct,poss,opp_poss,pace,off_rtg,def_rtg,
opp_fg2m,opp_fg2a,opp_fg2_pct,opp_fg2_sr,opp_fg3m,opp_fg3a,
opp_fg3_pct,opp_fg3_sr,opp_fgm,opp_fga,opp_fg_pct,opp_efg_pct,
opp_ts_pct,opp_ftm,opp_fta,opp_ft_pct,opp_ftr,opp_oreb,opp_oreb_pct,
opp_dreb,opp_dreb_pct,opp_treb,opp_treb_pct,opp_ast,opp_ast_pct,
opp_tov,opp_tov_pct,opp_tov_pts,opp_ast_tov_pct,opp_stl,opp_stl_pct,
opp_blk,opp_blk_pct)
View(df_adv)
df_adv <- df_agg %>%
mutate(
poss = round(fga - oreb + tov + (0.44 * fta),0),
opp_poss = round(opp_fga - opp_oreb + opp_tov + (0.44 * opp_fta),0),
pace = round((poss + opp_poss) * 48 / ((mins/5) * 2),0),
off_rtg = round((team_score/poss) * 100, 1),
def_rtg = round((opp_score/opp_poss) * 100, 1),
fg2_pct = fg2m/fg2a,
fg2_sr = (fga-fg2a)/fga,
fg3_pct = fg3m/fg3a,
fg3_sr = (fga-fg3a)/fga,
fg_pct = fgm/fga,
efg_pct = (fg3m*0.5 + fgm)/fga,
ts_pct = team_score/(fga*2 + fta*0.44),
ft_pct = ftm/fta,
ftr = ftm/fga,
oreb_pct = oreb/(oreb+opp_dreb),
dreb_pct = dreb/(dreb+opp_oreb),
treb_pct = treb/(treb+opp_treb),
ast_pct = ast/fgm,
tov_pct = tov/poss,
ast_tov_pct = ast/tov,
stl_pct = stl/opp_poss,
blk_pct = blk/(opp_fga-opp_fg3a),
opp_fg2_pct = opp_fg2m/opp_fg2a,
opp_fg2_sr = (opp_fga-opp_fg2a)/opp_fga,
opp_fg3_pct = opp_fg3m/opp_fg3a,
opp_fg3_sr = (opp_fga-opp_fg3a)/opp_fga,
opp_fg_pct = opp_fgm/opp_fga,
opp_efg_pct = (opp_fg3m*0.5 + opp_fgm)/opp_fga,
opp_ts_pct = opp_score/(opp_fga*2 + opp_fta*0.44),
opp_ft_pct = opp_ftm/opp_fta,
opp_ftr = opp_ftm/opp_fga,
opp_oreb_pct = opp_oreb/(opp_oreb+dreb),
opp_dreb_pct = opp_dreb/(opp_dreb+oreb),
opp_treb_pct = opp_treb/(treb+opp_treb),
opp_ast_pct = opp_ast/opp_fgm,
opp_tov_pct = opp_tov/opp_poss,
opp_ast_tov_pct = opp_ast/opp_tov,
opp_stl_pct = opp_stl/poss,
opp_blk_pct = opp_blk/(fga-fg3a)
) %>%
select(game_id:opp_score,fg2m,fg2a,fg2_pct,fg2_sr,fg3m,fg3a,fg3_pct,fg3_sr,
fgm,fga,fg_pct,efg_pct,ts_pct,ftm,fta,ft_pct,ftr,oreb,oreb_pct,
dreb,dreb_pct,treb,treb_pct,ast,ast_pct,tov,tov_pct,ast_tov_pct,tov_pts
stl,stl_pct,blk,blk_pct,poss,opp_poss,pace,off_rtg,def_rtg,
df_adv <- df_agg %>%
mutate(
poss = round(fga - oreb + tov + (0.44 * fta),0),
opp_poss = round(opp_fga - opp_oreb + opp_tov + (0.44 * opp_fta),0),
pace = round((poss + opp_poss) * 48 / ((mins/5) * 2),0),
off_rtg = round((team_score/poss) * 100, 1),
def_rtg = round((opp_score/opp_poss) * 100, 1),
fg2_pct = fg2m/fg2a,
fg2_sr = (fga-fg2a)/fga,
fg3_pct = fg3m/fg3a,
fg3_sr = (fga-fg3a)/fga,
fg_pct = fgm/fga,
efg_pct = (fg3m*0.5 + fgm)/fga,
ts_pct = team_score/(fga*2 + fta*0.44),
ft_pct = ftm/fta,
ftr = ftm/fga,
oreb_pct = oreb/(oreb+opp_dreb),
dreb_pct = dreb/(dreb+opp_oreb),
treb_pct = treb/(treb+opp_treb),
ast_pct = ast/fgm,
tov_pct = tov/poss,
ast_tov_pct = ast/tov,
stl_pct = stl/opp_poss,
blk_pct = blk/(opp_fga-opp_fg3a),
opp_fg2_pct = opp_fg2m/opp_fg2a,
opp_fg2_sr = (opp_fga-opp_fg2a)/opp_fga,
opp_fg3_pct = opp_fg3m/opp_fg3a,
opp_fg3_sr = (opp_fga-opp_fg3a)/opp_fga,
opp_fg_pct = opp_fgm/opp_fga,
opp_efg_pct = (opp_fg3m*0.5 + opp_fgm)/opp_fga,
opp_ts_pct = opp_score/(opp_fga*2 + opp_fta*0.44),
opp_ft_pct = opp_ftm/opp_fta,
opp_ftr = opp_ftm/opp_fga,
opp_oreb_pct = opp_oreb/(opp_oreb+dreb),
opp_dreb_pct = opp_dreb/(opp_dreb+oreb),
opp_treb_pct = opp_treb/(treb+opp_treb),
opp_ast_pct = opp_ast/opp_fgm,
opp_tov_pct = opp_tov/opp_poss,
opp_ast_tov_pct = opp_ast/opp_tov,
opp_stl_pct = opp_stl/poss,
opp_blk_pct = opp_blk/(fga-fg3a)
) %>%
select(game_id:opp_score,fg2m,fg2a,fg2_pct,fg2_sr,fg3m,fg3a,fg3_pct,fg3_sr,
fgm,fga,fg_pct,efg_pct,ts_pct,ftm,fta,ft_pct,ftr,oreb,oreb_pct,
dreb,dreb_pct,treb,treb_pct,ast,ast_pct,tov,tov_pct,ast_tov_pct,tov_pts,
stl,stl_pct,blk,blk_pct,poss,opp_poss,pace,off_rtg,def_rtg,
opp_fg2m,opp_fg2a,opp_fg2_pct,opp_fg2_sr,opp_fg3m,opp_fg3a,
opp_fg3_pct,opp_fg3_sr,opp_fgm,opp_fga,opp_fg_pct,opp_efg_pct,
opp_ts_pct,opp_ftm,opp_fta,opp_ft_pct,opp_ftr,opp_oreb,opp_oreb_pct,
opp_dreb,opp_dreb_pct,opp_treb,opp_treb_pct,opp_ast,opp_ast_pct,
opp_tov,opp_tov_pct,opp_ast_tov_pct,opp_tov_pts,opp_stl,opp_stl_pct,
opp_blk,opp_blk_pct)
View(df_adv)
View(df_adv)
df <- readRDS("odds_clean")
### hoopR DB ------------------------------
library(tidyverse)
library(lubridate)
library(hoopR)
library(RSQLite)
library(DBI)
options(dplyr.summarise.inform = FALSE)
Sys.setenv("VROOM_CONNECTION_SIZE" = 131072 * 2)
View(df)
# Collect nba betting odds
box_scores <- hoopR::load_nba_team_box(seasons = c(2014:2022)) %>%
filter(team_id <= 30) %>%
arrange(desc(game_id))
View(df)
View(box_scores)
df <- box_scores %>%
left_join(df, by = c("game_id"="game","team_home_away"="location","team_id"="team_id"))
df_odds <- box_scores %>%
left_join(df, by = c("game_id"="game_id","team_home_away"="location","team_id"="team_id"))
View(df_odds)
df_odds <- box_scores %>%
left_join(df, by = c("game_id"="game_id",
"team_home_away"="location",
"team_id"="team_id")) %>%
select(season == 2021)
View(df_odds)
df_odds <- box_scores %>%
left_join(df, by = c("game_id"="game_id",
"team_home_away"="location",
"team_id"="team_id")) %>%
filter(season == 2021) %>%
select(game_date,team_name,spread:implied_prob)
View(df_odds)
