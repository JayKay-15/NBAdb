"oFG","oSR2","oFG3","oSR3","oFT","oFTR","oORB","oDRB","oTRB",
"oAST","oTOV","oSTL","oBLK","oPF","oeFG","oTS",
"ORtg","DRtg","Pace")
### GROUPING HOME GAMES
home_grouped <- home %>%
select(3,6:38) %>%
group_by(teamName,teamGameCount) %>%
summarise(across(c(teamPTS:opptPF), sum))
###### HOME ADVANCED STATS ######
home_adv <- home_grouped
home_adv$Poss <- with(home_adv, teamFGA - teamORB + teamTOV + (.44 * teamFTA))
home_adv$oPoss <- with(home_adv, opptFGA - opptORB + opptTOV + (.44 * opptFTA))
home_adv$Pace <- with(home_adv, 48 * (Poss + oPoss) / (2 * (teamMin/5)))
home_adv$oPace <- with(home_adv, 48 * (Poss + oPoss) / (2 * (opptMin/5)))
home_adv$ORtg <- with(home_adv, (teamPTS / Poss) * 100)
home_adv$DRtg <- with(home_adv, (opptPTS / oPoss) * 100)
home_adv$FG <- with(home_adv, teamFGM / teamFGA)
home_adv$SR2 <- with(home_adv, (teamFGA - team3PA) / teamFGA)
home_adv$FG3 <- with(home_adv, team3PM / team3PA)
home_adv$SR3 <- with(home_adv, team3PA / teamFGA)
home_adv$FT <- with(home_adv, teamFTM / teamFTA)
home_adv$FTR <- with(home_adv, teamFTM / teamFGA)
home_adv$ORB <- with(home_adv, teamORB / (teamORB + opptDRB))
home_adv$DRB <- with(home_adv, teamDRB / (teamDRB + opptORB))
home_adv$TRB <- with(home_adv, teamTRB / (teamTRB + opptTRB))
home_adv$AST <- with(home_adv, teamAST / teamFGM)
home_adv$TOV <- with(home_adv, teamTOV / Poss)
home_adv$STL <- with(home_adv, teamSTL / oPoss)
home_adv$BLK <- with(home_adv, teamBLK / (opptFGA - oppt3PA))
home_adv$PF <- with(home_adv, teamPF / oPoss)
home_adv$eFG <- with(home_adv, (teamFGM + .5 * team3PM) / teamFGA)
home_adv$TS <- with(home_adv, teamPTS / (2 * teamFGA + .44 * teamFTA))
home_adv$oFG <- with(home_adv, opptFGM / opptFGA)
home_adv$oSR2 <- with(home_adv, (opptFGA - oppt3PA) / opptFGA)
home_adv$oFG3 <- with(home_adv, oppt3PM / oppt3PA)
home_adv$oSR3 <- with(home_adv, oppt3PA / opptFGA)
home_adv$oFT <- with(home_adv, opptFTM / opptFTA)
home_adv$oFTR <- with(home_adv, opptFTM / opptFGA)
home_adv$oORB <- with(home_adv, opptORB / (opptORB + teamDRB))
home_adv$oDRB <- with(home_adv, opptDRB / (opptDRB + teamORB))
home_adv$oTRB <- with(home_adv, opptTRB / (teamTRB + opptTRB))
home_adv$oAST <- with(home_adv, opptAST / opptFGM)
home_adv$oTOV <- with(home_adv, opptTOV / oPoss)
home_adv$oSTL <- with(home_adv, opptSTL / Poss)
home_adv$oBLK <- with(home_adv, opptBLK / (teamFGA - team3PA))
home_adv$oPF <- with(home_adv, opptPF / Poss)
home_adv$oeFG <- with(home_adv, (opptFGM + .5 * oppt3PM) / opptFGA)
home_adv$oTS <- with(home_adv, opptPTS / (2 * opptFGA + .44 * opptFTA))
home_final <- home_adv %>%
select(1,41:72,39,40,37)
##### WEIGHTING - home ####
wt_holder_home <- data.frame()
a <- 1
g <- nrow(home_final)
for (a in a:g) {
act_id <- as.character(home_final[a,1])
adj_gxg <- home_final %>%
filter(teamName == act_id)
ngames <- nrow(adj_gxg)
if (ngames > 20) { weightmax <- 4 } else { weightmax <- 1 + ((ngames - 1) * .157894737)  }
weightmin <- 1
weightdist <- (weightmax - weightmin) / (ngames - 1)
if (ngames < 2) { weightdist <- 0 }
weightcurve <- matrix(0, nrow = ngames, ncol = 1)
c <- 1
i <- nrow(weightcurve)
for (c in c:i) {
weightcurve[c] <- weightmin + ((c - 1) * weightdist)
}
weight_sums <- sum(weightcurve)
weight_avg <- mean(weightcurve)
FG_wt <- (adj_gxg$FG * weightcurve) / weight_sums
SR2_wt <- (adj_gxg$SR2 * weightcurve) / weight_sums
FG3_wt <- (adj_gxg$FG3 * weightcurve) / weight_sums
SR3_wt <- (adj_gxg$SR3 * weightcurve) / weight_sums
FT_wt <- (adj_gxg$FT * weightcurve) / weight_sums
FTR_wt <- (adj_gxg$FTR * weightcurve) / weight_sums
ORB_wt <- (adj_gxg$ORB * weightcurve) / weight_sums
DRB_wt <- (adj_gxg$DRB * weightcurve) / weight_sums
TRB_wt <- (adj_gxg$TRB * weightcurve) / weight_sums
AST_wt <- (adj_gxg$AST * weightcurve) / weight_sums
TOV_wt <- (adj_gxg$TOV * weightcurve) / weight_sums
STL_wt <- (adj_gxg$STL * weightcurve) / weight_sums
BLK_wt <- (adj_gxg$BLK * weightcurve) / weight_sums
PF_wt <- (adj_gxg$PF * weightcurve) / weight_sums
eFG_wt <- (adj_gxg$eFG * weightcurve) / weight_sums
TS_wt <- (adj_gxg$TS * weightcurve) / weight_sums
Pace_wt <- (adj_gxg$Pace * weightcurve) / weight_sums
ORtg_wt <- (adj_gxg$ORtg * weightcurve) / weight_sums
DRtg_wt <- (adj_gxg$DRtg * weightcurve) / weight_sums
oFG_wt <- (adj_gxg$oFG * weightcurve) / weight_sums
oSR2_wt <- (adj_gxg$oSR2 * weightcurve) / weight_sums
oFG3_wt <- (adj_gxg$oFG3 * weightcurve) / weight_sums
oSR3_wt <- (adj_gxg$oSR3 * weightcurve) / weight_sums
oFT_wt <- (adj_gxg$oFT * weightcurve) / weight_sums
oFTR_wt <- (adj_gxg$oFTR * weightcurve) / weight_sums
oORB_wt <- (adj_gxg$oORB * weightcurve) / weight_sums
oDRB_wt <- (adj_gxg$oDRB * weightcurve) / weight_sums
oTRB_wt <- (adj_gxg$oTRB * weightcurve) / weight_sums
oAST_wt <- (adj_gxg$oAST * weightcurve) / weight_sums
oTOV_wt <- (adj_gxg$oTOV * weightcurve) / weight_sums
oSTL_wt <- (adj_gxg$oSTL * weightcurve) / weight_sums
oBLK_wt <- (adj_gxg$oBLK * weightcurve) / weight_sums
oPF_wt <- (adj_gxg$oPF * weightcurve) / weight_sums
oeFG_wt <- (adj_gxg$oeFG * weightcurve) / weight_sums
oTS_wt <- (adj_gxg$oTS * weightcurve) / weight_sums
FG_wt <- sum(FG_wt)
SR2_wt <- sum(SR2_wt)
FG3_wt <- sum(FG3_wt)
SR3_wt <- sum(SR3_wt)
FT_wt <- sum(FT_wt)
FTR_wt <- sum(FTR_wt)
ORB_wt <- sum(ORB_wt)
DRB_wt <- sum(DRB_wt)
TRB_wt <- sum(TRB_wt)
AST_wt <- sum(AST_wt)
TOV_wt <- sum(TOV_wt)
STL_wt <- sum(STL_wt)
BLK_wt <- sum(BLK_wt)
PF_wt <- sum(PF_wt)
eFG_wt <- sum(eFG_wt)
TS_wt <- sum(TS_wt)
Pace_wt <- sum(Pace_wt)
ORtg_wt <- sum(ORtg_wt)
DRtg_wt <- sum(DRtg_wt)
oFG_wt <- sum(oFG_wt)
oSR2_wt <- sum(oSR2_wt)
oFG3_wt <- sum(oFG3_wt)
oSR3_wt <- sum(oSR3_wt)
oFT_wt <- sum(oFT_wt)
oFTR_wt <- sum(oFTR_wt)
oORB_wt <- sum(oORB_wt)
oDRB_wt <- sum(oDRB_wt)
oTRB_wt <- sum(oTRB_wt)
oAST_wt <- sum(oAST_wt)
oTOV_wt <- sum(oTOV_wt)
oSTL_wt <- sum(oSTL_wt)
oBLK_wt <- sum(oBLK_wt)
oPF_wt <- sum(oPF_wt)
oeFG_wt <- sum(oeFG_wt)
oTS_wt <- sum(oTS_wt)
wt_df <- data.frame(act_id,FG_wt,SR2_wt,FG3_wt,SR3_wt,FT_wt,
FTR_wt,ORB_wt,DRB_wt,TRB_wt,AST_wt,TOV_wt,
STL_wt,BLK_wt,PF_wt,eFG_wt,TS_wt,oFG_wt,oSR2_wt,oFG3_wt,oSR3_wt,
oFT_wt,oFTR_wt,oORB_wt,oDRB_wt,oTRB_wt,oAST_wt,
oTOV_wt,oSTL_wt,oBLK_wt,oPF_wt,oeFG_wt,oTS_wt,
ORtg_wt,DRtg_wt,Pace_wt)
wt_holder_home <- bind_rows(wt_holder_home,wt_df)
}
home_final_wt <- wt_holder_home
colnames(home_final_wt) <- c("Team","FG","SR2","FG3","SR3","FT","FTR","ORB","DRB","TRB",
"AST","TOV","STL","BLK","PF","eFG","TS",
"oFG","oSR2","oFG3","oSR3","oFT","oFTR","oORB","oDRB","oTRB",
"oAST","oTOV","oSTL","oBLK","oPF","oeFG","oTS",
"ORtg","DRtg","Pace")
### GROUPING AWAY GAMES
away_grouped <- away %>%
select(3,6:38) %>%
group_by(teamName,teamGameCount) %>%
summarise(across(c(teamPTS:opptPF), sum))
###### AWAY ADVANCED STATS #####
away_adv <- away_grouped
away_adv$Poss <- with(away_adv, teamFGA - teamORB + teamTOV + (.44 * teamFTA))
away_adv$oPoss <- with(away_adv, opptFGA - opptORB + opptTOV + (.44 * opptFTA))
away_adv$Pace <- with(away_adv, 48 * (Poss + oPoss) / (2 * (teamMin/5)))
away_adv$oPace <- with(away_adv, 48 * (Poss + oPoss) / (2 * (opptMin/5)))
away_adv$ORtg <- with(away_adv, (teamPTS / Poss) * 100)
away_adv$DRtg <- with(away_adv, (opptPTS / oPoss) * 100)
away_adv$FG <- with(away_adv, teamFGM / teamFGA)
away_adv$SR2 <- with(away_adv, (teamFGA - team3PA) / teamFGA)
away_adv$FG3 <- with(away_adv, team3PM / team3PA)
away_adv$SR3 <- with(away_adv, team3PA / teamFGA)
away_adv$FT <- with(away_adv, teamFTM / teamFTA)
away_adv$FTR <- with(away_adv, teamFTM / teamFGA)
away_adv$ORB <- with(away_adv, teamORB / (teamORB + opptDRB))
away_adv$DRB <- with(away_adv, teamDRB / (teamDRB + opptORB))
away_adv$TRB <- with(away_adv, teamTRB / (teamTRB + opptTRB))
away_adv$AST <- with(away_adv, teamAST / teamFGM)
away_adv$TOV <- with(away_adv, teamTOV / Poss)
away_adv$STL <- with(away_adv, teamSTL / oPoss)
away_adv$BLK <- with(away_adv, teamBLK / (opptFGA - oppt3PA))
away_adv$PF <- with(away_adv, teamPF / oPoss)
away_adv$eFG <- with(away_adv, (teamFGM + .5 * team3PM) / teamFGA)
away_adv$TS <- with(away_adv, teamPTS / (2 * teamFGA + .44 * teamFTA))
away_adv$oFG <- with(away_adv, opptFGM / opptFGA)
away_adv$oSR2 <- with(away_adv, (opptFGA - oppt3PA) / opptFGA)
away_adv$oFG3 <- with(away_adv, oppt3PM / oppt3PA)
away_adv$oSR3 <- with(away_adv, oppt3PA / opptFGA)
away_adv$oFT <- with(away_adv, opptFTM / opptFTA)
away_adv$oFTR <- with(away_adv, opptFTM / opptFGA)
away_adv$oORB <- with(away_adv, opptORB / (opptORB + teamDRB))
away_adv$oDRB <- with(away_adv, opptDRB / (opptDRB + teamORB))
away_adv$oTRB <- with(away_adv, opptTRB / (teamTRB + opptTRB))
away_adv$oAST <- with(away_adv, opptAST / opptFGM)
away_adv$oTOV <- with(away_adv, opptTOV / oPoss)
away_adv$oSTL <- with(away_adv, opptSTL / Poss)
away_adv$oBLK <- with(away_adv, opptBLK / (teamFGA - team3PA))
away_adv$oPF <- with(away_adv, opptPF / Poss)
away_adv$oeFG <- with(away_adv, (opptFGM + .5 * oppt3PM) / opptFGA)
away_adv$oTS <- with(away_adv, opptPTS / (2 * opptFGA + .44 * opptFTA))
away_final <- away_adv %>%
select(1,41:72,39,40,37)
##### WEIGHTING - away ####
wt_holder_away <- data.frame()
a <- 1
g <- nrow(away_final)
for (a in a:g) {
act_id <- as.character(away_final[a,1])
adj_gxg <- away_final %>%
filter(teamName == act_id)
ngames <- nrow(adj_gxg)
if (ngames > 20) { weightmax <- 4 } else { weightmax <- 1 + ((ngames - 1) * .157894737)  }
weightmin <- 1
weightdist <- (weightmax - weightmin) / (ngames - 1)
if (ngames < 2) { weightdist <- 0 }
weightcurve <- matrix(0, nrow = ngames, ncol = 1)
c <- 1
i <- nrow(weightcurve)
for (c in c:i) {
weightcurve[c] <- weightmin + ((c - 1) * weightdist)
}
weight_sums <- sum(weightcurve)
weight_avg <- mean(weightcurve)
FG_wt <- (adj_gxg$FG * weightcurve) / weight_sums
SR2_wt <- (adj_gxg$SR2 * weightcurve) / weight_sums
FG3_wt <- (adj_gxg$FG3 * weightcurve) / weight_sums
SR3_wt <- (adj_gxg$SR3 * weightcurve) / weight_sums
FT_wt <- (adj_gxg$FT * weightcurve) / weight_sums
FTR_wt <- (adj_gxg$FTR * weightcurve) / weight_sums
ORB_wt <- (adj_gxg$ORB * weightcurve) / weight_sums
DRB_wt <- (adj_gxg$DRB * weightcurve) / weight_sums
TRB_wt <- (adj_gxg$TRB * weightcurve) / weight_sums
AST_wt <- (adj_gxg$AST * weightcurve) / weight_sums
TOV_wt <- (adj_gxg$TOV * weightcurve) / weight_sums
STL_wt <- (adj_gxg$STL * weightcurve) / weight_sums
BLK_wt <- (adj_gxg$BLK * weightcurve) / weight_sums
PF_wt <- (adj_gxg$PF * weightcurve) / weight_sums
eFG_wt <- (adj_gxg$eFG * weightcurve) / weight_sums
TS_wt <- (adj_gxg$TS * weightcurve) / weight_sums
Pace_wt <- (adj_gxg$Pace * weightcurve) / weight_sums
ORtg_wt <- (adj_gxg$ORtg * weightcurve) / weight_sums
DRtg_wt <- (adj_gxg$DRtg * weightcurve) / weight_sums
oFG_wt <- (adj_gxg$oFG * weightcurve) / weight_sums
oSR2_wt <- (adj_gxg$oSR2 * weightcurve) / weight_sums
oFG3_wt <- (adj_gxg$oFG3 * weightcurve) / weight_sums
oSR3_wt <- (adj_gxg$oSR3 * weightcurve) / weight_sums
oFT_wt <- (adj_gxg$oFT * weightcurve) / weight_sums
oFTR_wt <- (adj_gxg$oFTR * weightcurve) / weight_sums
oORB_wt <- (adj_gxg$oORB * weightcurve) / weight_sums
oDRB_wt <- (adj_gxg$oDRB * weightcurve) / weight_sums
oTRB_wt <- (adj_gxg$oTRB * weightcurve) / weight_sums
oAST_wt <- (adj_gxg$oAST * weightcurve) / weight_sums
oTOV_wt <- (adj_gxg$oTOV * weightcurve) / weight_sums
oSTL_wt <- (adj_gxg$oSTL * weightcurve) / weight_sums
oBLK_wt <- (adj_gxg$oBLK * weightcurve) / weight_sums
oPF_wt <- (adj_gxg$oPF * weightcurve) / weight_sums
oeFG_wt <- (adj_gxg$oeFG * weightcurve) / weight_sums
oTS_wt <- (adj_gxg$oTS * weightcurve) / weight_sums
FG_wt <- sum(FG_wt)
SR2_wt <- sum(SR2_wt)
FG3_wt <- sum(FG3_wt)
SR3_wt <- sum(SR3_wt)
FT_wt <- sum(FT_wt)
FTR_wt <- sum(FTR_wt)
ORB_wt <- sum(ORB_wt)
DRB_wt <- sum(DRB_wt)
TRB_wt <- sum(TRB_wt)
AST_wt <- sum(AST_wt)
TOV_wt <- sum(TOV_wt)
STL_wt <- sum(STL_wt)
BLK_wt <- sum(BLK_wt)
PF_wt <- sum(PF_wt)
eFG_wt <- sum(eFG_wt)
TS_wt <- sum(TS_wt)
Pace_wt <- sum(Pace_wt)
ORtg_wt <- sum(ORtg_wt)
DRtg_wt <- sum(DRtg_wt)
oFG_wt <- sum(oFG_wt)
oSR2_wt <- sum(oSR2_wt)
oFG3_wt <- sum(oFG3_wt)
oSR3_wt <- sum(oSR3_wt)
oFT_wt <- sum(oFT_wt)
oFTR_wt <- sum(oFTR_wt)
oORB_wt <- sum(oORB_wt)
oDRB_wt <- sum(oDRB_wt)
oTRB_wt <- sum(oTRB_wt)
oAST_wt <- sum(oAST_wt)
oTOV_wt <- sum(oTOV_wt)
oSTL_wt <- sum(oSTL_wt)
oBLK_wt <- sum(oBLK_wt)
oPF_wt <- sum(oPF_wt)
oeFG_wt <- sum(oeFG_wt)
oTS_wt <- sum(oTS_wt)
wt_df <- data.frame(act_id,FG_wt,SR2_wt,FG3_wt,SR3_wt,FT_wt,
FTR_wt,ORB_wt,DRB_wt,TRB_wt,AST_wt,TOV_wt,
STL_wt,BLK_wt,PF_wt,eFG_wt,TS_wt,oFG_wt,oSR2_wt,oFG3_wt,oSR3_wt,
oFT_wt,oFTR_wt,oORB_wt,oDRB_wt,oTRB_wt,oAST_wt,
oTOV_wt,oSTL_wt,oBLK_wt,oPF_wt,oeFG_wt,oTS_wt,
ORtg_wt,DRtg_wt,Pace_wt)
wt_holder_away <- bind_rows(wt_holder_away,wt_df)
}
away_final_wt <- wt_holder_away
colnames(away_final_wt) <- c("Team","FG","SR2","FG3","SR3","FT","FTR","ORB","DRB","TRB",
"AST","TOV","STL","BLK","PF","eFG","TS",
"oFG","oSR2","oFG3","oSR3","oFT","oFTR","oORB","oDRB","oTRB",
"oAST","oTOV","oSTL","oBLK","oPF","oeFG","oTS",
"ORtg","DRtg","Pace")
##### Scores Only ####
scores <- game_range %>%
select(13,8,62,17,90,45)
colnames(scores) <- c("Date", "Loc", "Away", "Home", "AS", "HS")
scores <- scores %>%
filter(Loc == "H" & Date == gm_day_gxg)
scores <- left_join(scores, away_final_wt, by = c("Away" = "Team")) %>%
left_join(., home_final_wt, by = c("Home" = "Team"))
colnames(scores)[7:76] <- c("FG_away","SR2_away","FG3_away","SR3_away","FT_away","FTR_away",
"ORB_away","DRB_away","TRB_away","AST_away","TOV_away","STL_away",
"BLK_away","PF_away","eFG_away","TS_away",
"oFG_away","oSR2away","oFG3_away","oSR3_away","oFT_away","oFTR_away",
"oORB_away","oDRB_away","oTRB_away","oAST_away","oTOV_away","oSTL_away",
"oBLK_away","oPF_away","oeFG_away","oTS_away",
"ORtg_away","DRtg_away","Pace_away",
"FG_home","SR2_home","FG3_home","SR3_home","FT_home","FTR_home",
"ORB_home","DRB_home","TRB_home","AST_home","TOV_home","STL_home",
"BLK_home","PF_home","eFG_home","TS_home",
"oFG_home","oSR2home","oFG3_home","oSR3_home","oFT_home","oFTR_home",
"oORB_home","oDRB_home","oTRB_home","oAST_home","oTOV_home","oSTL_home",
"oBLK_home","oPF_home","oeFG_home","oTS_home",
"ORtg_home","DRtg_home","Pace_home")
final_db <- bind_rows(final_db,scores)
print(paste(tail(final_db$Date, n = 1), "Complete"))
}
final_db$Margin <- final_db$AS - final_db$HS
final_db$Win <- if_else(final_db$AS > final_db$HS, 1, 0)
final_db <- final_db %>%
select(1:6,77,78,7:76) %>%
arrange(Date)
wb <- createWorkbook()
addWorksheet(wb, sheetName = "final_db")
writeData(wb, sheet = "final_db", x = final_db)
saveWorkbook(wb, file = u)
#### 2022 Model Training ####
library(tidyverse)
library(caTools)
library(readxl)
library(tidymodels)
library(broom)
library(ggfortify)
library(caret)
library(glmnet)
library(InformationValue)
library(class)
library(e1071)
devtools::install_github("bips-hb/neuralnet", force = T)
library(neuralnet)
library(xgboost)
library(mctest)
rm(list=ls())
nba <- read_xlsx("/Users/Jesse/Documents/MyStuff/NBA Betting/NBAdb/NBAdb1722_noadj.xlsx")
## no correlation - eFG
nba_reg <- nba %>%
select(7,
14,15,16,18,19,21,23,30,34,35,37,39,43,
49,50,51,53,54,56,58,65,69,70,72,74,78)
set.seed(214)
sample <- sample.split(nba_reg$Margin, SplitRatio = .70)
train <- nba_reg %>% filter(sample == TRUE)
test <- nba_reg %>% filter(sample == FALSE)
pre_proc_val <- preProcess(train[,-1], method = c("center", "scale"))
train[,-1] = predict(pre_proc_val, train[,-1])
test[,-1] = predict(pre_proc_val, test[,-1])
lin_mod <- lm(Margin ~., data = train)
summary(lin_mod)
#Step 1 - create the evaluation metrics function
eval_metrics <- function(model, df, predictions, target) {
resids = df[,target] - predictions
resids2 = resids**2
N = length(predictions)
r2 = as.character(round(summary(model)$r.squared, 4))
adj_r2 = as.character(round(summary(model)$adj.r.squared, 4))
print(adj_r2) #Adjusted R-squared
print(as.character(round(sqrt(sum(resids2)/N), 4))) #RMSE
}
# Step 2 - predicting and evaluating the model on train data
predictions = predict(lin_mod, newdata = train)
eval_metrics(lin_mod, train, predictions, target = 'Margin')
# Step 3 - predicting and evaluating the model on test data
predictions = predict(lin_mod, newdata = test)
eval_metrics(lin_mod, test, predictions, target = 'Margin')
### Ridge & Lasso models
dummies <- dummyVars(Margin ~ ., data = nba_reg)
train_dummies = predict(dummies, newdata = train)
test_dummies = predict(dummies, newdata = test)
print(dim(train_dummies)); print(dim(test_dummies))
x = as.matrix(train_dummies)
y_train = train$Margin
x_test = as.matrix(test_dummies)
y_test = test$Margin
# Compute R^2 from true and predicted values
eval_results <- function(true, predicted, df) {
SSE <- sum((predicted - true)^2)
SST <- sum((true - mean(true))^2)
R_square <- 1 - SSE / SST
RMSE = sqrt(SSE/nrow(df))
# Model performance metrics
data.frame(
Rsquare = R_square,
RMSE = RMSE
)
}
### Ridge model
lambdas <- 10^seq(2, -3, by = -.1)
ridge_reg = glmnet(x, y_train, nlambda = 25, alpha = 0, family = 'gaussian', lambda = lambdas)
par(mfrow = c(1, 2))
plot(ridge_reg)
plot(ridge_reg, xvar = "lambda", label = TRUE)
summary(ridge_reg)
cv_ridge <- cv.glmnet(x, y_train, alpha = 0, lambda = lambdas)
plot(cv_ridge)
optimal_lambda <- cv_ridge$lambda.min
optimal_lambda
# Prediction and evaluation on train data
predictions_train <- predict(ridge_reg, s = optimal_lambda, newx = x)
eval_results(y_train, predictions_train, train)
# Prediction and evaluation on test data
predictions_test <- predict(ridge_reg, s = optimal_lambda, newx = x_test)
eval_results(y_test, predictions_test, test)
# Lasso model
lambdas <- 10^seq(2, -3, by = -.1)
# Setting alpha = 1 implements lasso regression
lasso_reg <- cv.glmnet(x, y_train, alpha = 1, lambda = lambdas, standardize = TRUE, nfolds = 5,
family='gaussian', type.measure='mse')
plot(lasso_reg)
plot(lasso_reg$glmnet.fit, xvar="lambda", label=TRUE)
cat('Min Lambda: ', lasso_reg$lambda.min, '\n 1Sd Lambda: ', lasso_reg$lambda.1se)
df_coef <- round(as.matrix(coef(lasso_reg, s=lasso_reg$lambda.min)), 2)
# See all contributing variables
df_coef[df_coef[, 1] != 0, ]
# Best
lambda_best <- lasso_reg$lambda.min
lambda_best
lasso_model <- glmnet(x, y_train, alpha = 1, lambda = lambda_best, standardize = TRUE, family='gaussian')
lasso_model$beta
predictions_train <- predict(lasso_model, s = lambda_best, newx = x)
eval_results(y_train, predictions_train, train)
predictions_test <- predict(lasso_model, s = lambda_best, newx = x_test)
eval_results(y_test, predictions_test, test)
# Elastic Net
# Set training control
train_cont <- trainControl(method = "repeatedcv",
number = 10,
repeats = 5,
search = "random",
verboseIter = TRUE)
# Train the model
elastic_reg <- train(Margin ~ .,
data = train,
method = "glmnet",
preProcess = c("center", "scale"),
tuneLength = 10,
trControl = train_cont)
# Best tuning parameter
elastic_reg$bestTune
# Make predictions on training set
predictions_train <- predict(elastic_reg, x)
eval_results(y_train, predictions_train, train)
# Make predictions on test set
predictions_test <- predict(elastic_reg, x_test)
eval_results(y_test, predictions_test, test)
source("~/Documents/MyStuff/NBA Betting/NBAdb/NBAdb.R", echo=TRUE)
warnings()
source("~/Documents/MyStuff/NBA Betting/NBAdb/NBAdb.R", echo=TRUE)
#### 2022 Model Training ####
library(tidyverse)
library(caTools)
library(readxl)
library(tidymodels)
library(broom)
library(ggfortify)
library(caret)
library(glmnet)
library(InformationValue)
library(class)
library(e1071)
# devtools::install_github("bips-hb/neuralnet", force = T)
library(neuralnet)
library(xgboost)
library(mctest)
rm(list=ls())
if (!require("pacman")) install.packages("pacman"); library(pacman)
pacman::p_load(tidyverse, readxl, lubridate, openxlsx, nbastatR)
options(dplyr.summarise.inform = FALSE)
Sys.setenv("VROOM_CONNECTION_SIZE" = 131072 * 2)
rm(list=ls())
setwd("/Users/Jesse/Documents/MyStuff/NBA Betting/NBAdb/")
fn <- "NBAdb1922_Adj"
u <- paste0("/Users/Jesse/Documents/MyStuff/NBA Betting/NBAdb/",fn,".xlsx")
final_db <- data.frame()
game_logs(seasons = c(2019:2022), result_types = c("team","players"))
dataGameLogsTeam <- dataGameLogsTeam %>% arrange(dateGame,idGame)
dataGameLogsTeam$dateGame <- as_date(dataGameLogsTeam$dateGame)
dates19 <- dataGameLogsTeam %>%
filter(yearSeason == 2019) %>%
distinct(dateGame) %>%
mutate(stat_start = min(dateGame)) %>%
mutate(stat_end = dateGame - 1) %>%
mutate(adj = if_else(dateGame <= min(as.Date(dateGame)) + 21, 0, 1))
View(dates19)
View(dates19)
dates19[c(1:11),3] <- dates19[c(1:11),1]
View(dates19)
View(dates19)
